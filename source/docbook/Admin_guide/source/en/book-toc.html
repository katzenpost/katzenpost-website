<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Katzenpost administrator's guide</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">Katzenpost administrator's guide</h1>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#components">Components and configuration of the Katzenpost
mixnet</a>
<ul>
<li><a href="#overview">Understanding the Katzenpost components</a>
<ul>
<li><a href="#intro-dirauth">Directory authorities (dirauths)</a></li>
<li><a href="#intro-mix">Mix nodes</a></li>
<li><a href="#intro-gateway">Gateway nodes</a></li>
<li><a href="#intro-service">Service nodes</a></li>
<li><a href="#intro-client">Clients</a></li>
</ul></li>
<li><a href="#configuration">Configuring Katzenpost</a>
<ul>
<li><a href="#auth-config">Configuring directory authorities</a>
<ul>
<li><a href="#auth-server-section-config">Dirauth: Server
section</a></li>
<li><a href="#auth-authorities-section-config">Dirauth:
<code>Authorities</code> section</a></li>
<li><a href="#auth-logging">Dirauth: Logging section</a>
<ul>
<li></li>
</ul></li>
<li><a href="#auth-parameters">Dirauth: Parameters section</a></li>
<li><a href="#auth-debug">Dirauth: Debug section</a></li>
<li><a href="#auth-mixes-section-config">Dirauth: Mixes
sections</a></li>
<li><a href="#auth-gatewaynodes-section-config">Dirauth: GatewayNodes
section</a></li>
<li><a href="#auth-servicenodes-section-config">Dirauth: ServiceNodes
sections</a></li>
<li><a href="#auth-topology">Dirauth: Topology section</a></li>
<li><a href="#auth-sphinx-config">Dirauth: SphinxGeometry section</a>
<ul>
<li></li>
</ul></li>
</ul></li>
<li><a href="#mix-config">Configuring mix nodes</a>
<ul>
<li><a href="#mix-server-section-config">Mix node: Server section</a>
<ul>
<li></li>
</ul></li>
<li><a href="#mix-logging-config">Mix node: Logging section</a>
<ul>
<li></li>
</ul></li>
<li><a href="#mix-pki-config">Mix node: PKI section</a>
<ul>
<li></li>
</ul></li>
<li><a href="#mix-management-config">Mix node: Management section</a>
<ul>
<li></li>
</ul></li>
<li><a href="#mix-sphinx-config">Mix node: SphinxGeometry section</a>
<ul>
<li></li>
</ul></li>
<li><a href="#mix-debug-config">Mix node: Debug section</a>
<ul>
<li></li>
</ul></li>
</ul></li>
<li><a href="#gateway-config">Configuring gateway nodes</a>
<ul>
<li><a href="#gateway-server-section-config">Gateway node: Server
section</a>
<ul>
<li></li>
</ul></li>
<li><a href="#gateway-logging-config">Gateway node: Logging section</a>
<ul>
<li></li>
</ul></li>
<li><a href="#gateway-gateway-section-config">Gateway node: Gateway
section</a></li>
<li><a href="#gateway-pki-config">Gateway node: PKI section</a>
<ul>
<li></li>
</ul></li>
<li><a href="#gateway-management-config">Gateway node: Management
section</a>
<ul>
<li></li>
</ul></li>
<li><a href="#gateway-sphinx-config">Gateway node: SphinxGeometry
section</a>
<ul>
<li></li>
</ul></li>
<li><a href="#gateway-debug-config">Gateway node: Debug section</a>
<ul>
<li></li>
</ul></li>
</ul></li>
<li><a href="#service-config">Configuring service nodes</a>
<ul>
<li><a href="#service-server-section-config">Service node: Server
section</a>
<ul>
<li></li>
</ul></li>
<li><a href="#service-logging-config">Service node: Logging section</a>
<ul>
<li></li>
</ul></li>
<li><a href="#service-servicenode-section-config">Service node:
ServiceNode section</a></li>
<li><a href="#service-pki-config">Service node: PKI section</a>
<ul>
<li></li>
</ul></li>
<li><a href="#service-management-config">Service node: Management
section</a>
<ul>
<li></li>
</ul></li>
<li><a href="#service-sphinx-config">Service node: SphinxGeometry
section</a>
<ul>
<li></li>
</ul></li>
<li><a href="#service-debug-config">Service node: Debug section</a>
<ul>
<li></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li><a href="#container">Using the Katzenpost Docker test network</a>
<ul>
<li><a href="#requirements">Requirements</a></li>
<li><a href="#install_kp">Preparing to run the container image</a></li>
<li><a href="#basic-ops">Operating the test mixnet</a>
<ul>
<li><a href="#start-mixnet">Starting and monitoring the mixnet</a></li>
<li><a href="#test-mixnet">Testing the mixnet</a></li>
<li><a href="#shutdown-mixnet">Shutting down the mixnet</a></li>
<li><a href="#uninstall-mixnet">Uninstalling and cleaning up</a></li>
</ul></li>
<li><a href="#topology">Network topology and components</a>
<ul>
<li>The Docker file tree</li>
</ul></li>
<li></li>
</ul></li>
<li><a href="#docker-config">Appendix: Configuration files from the
Docker test mixnet</a>
<ul>
<li><a href="#dirauth-config">Directory authority</a></li>
<li><a href="#mix-node-config">Mix node</a></li>
<li><a href="#gateway-node-config">Gateway node</a></li>
<li><a href="#service-node-config">Service node</a></li>
</ul></li>
<li><a href="#gensphinx">Appendix: Using <em>gensphinx</em></a></li>
</ul>
</nav>
<h1 id="introduction">Introduction</h1>
<p>To Do</p>
<h1 id="components">Components and configuration of the Katzenpost
mixnet</h1>
<p>This section of the Katzenpost technical documentation provides an
introduction to the software components that make up Katzenpost and
guidance on how to configure each component. The intended reader is a
system administrator who wants to implement a working, production
Katzenpost network.</p>
<p>For information about the theory and design of this software, see <a
href="#introduction">Introduction</a>. For a quickly deployable,
non-production test network (primarily for use by developers), see <a
href="#container">Using the Katzenpost Docker test network</a>.</p>
<h2 id="overview">Understanding the Katzenpost components</h2>
<p>The core of Katzenpost consists of two program executables, <a
href="#voter-usage">dirauth</a> and <a href="#server-usage">server</a>.
Running the <code>dirauth</code>commmand runs a <em>directory
authority</em> node, or <em>dirauth</em>, that functions as part of the
mixnet's public-key infrastructure (PKI). Running the
<code>server</code> runs either a <em>mix</em> node, a <em>gateway</em>
node, or a <em>service</em> node, depending on the configuration.
Configuration settings are provided in an associated
<code>katzenpost-authority.toml</code> or <code>katzenpost.toml</code>
file respectively.</p>
<p>In addition to the server components, Katzenpost also supports
connections to client applications hosted externally to the mix network
and communicating with it through gateway nodes.</p>
<p>A model mix network is shown in Figure 1.</p>
<figure>
<img src="/static/admin_guide/pix/components-production.png"
alt="The pictured element types correspond to discrete client and server programs that Katzenpost requires to function." />
<figcaption aria-hidden="true">The pictured element types correspond to
discrete client and server programs that Katzenpost requires to
function.</figcaption>
</figure>
<p>The mix network contains an <em>n</em>-layer topology of mix-nodes,
with three nodes per layer in this example. Sphinx packets traverse the
network in one direction only. The gateway nodes allow clients to
interact with the mix network. The service nodes provide mix network
services that mix network clients can interact with. All messages sent
by clients are handed to a <em>connector</em> daemon hosted on the
client system, passed across the Internet to a gateway, and then relayed
to a service node by way of the nine mix nodes. The service node sends
its reply back across the mix-node layers to a gateway, which transmits
it across the Internet to be received by the targeted client. The mix,
gateway, and service nodes send <em>mix descriptors</em> to the dirauths
and retrieve a <em>consensus document</em> from them, described
below.</p>
<p>In addition to the server components, Katzenpost supports connections
to client applications hosted externally to the mix network and
communicating with it through gateway nodes and, in some cases, a client
connector.</p>
<h3 id="intro-dirauth">Directory authorities (dirauths)</h3>
<p>Dirauths compose the decentralized public key infrastructure (PKI)
that serves as the root of security for the entire mix network. Clients,
mix nodes, gateways nodes, and service nodes rely on the PKI/dirauth
system to maintain and sign an up-to-date consensus document, providing
a view of the network including connection information and public
cryptographic key materials and signatures.</p>
<p>Every 20 minutes (the current value for an <em>epoch</em>), each mix,
gateway, and service node signs a mix descriptor and uploads it to the
dirauths. The dirauths then vote on a new consensus document. If
consensus is reached, each dirauth signs the document. Clients and nodes
download the document as needed and verify the signatures. Consensus
fails when 1/2 + 1 nodes fail, which yields greater fault tolerance
than, for example, Byzantine Fault Tolerance, which fails when 1/3 + 1
of the nodes fail.</p>
<p>The PKI signature scheme is fully configurable by the dirauths. Our
recommendation is to use a hybrid signature scheme consisting of
classical Ed25519 and the post-quantum, stateless, hash-based signature
scheme known as Sphincs+ (with the parameters: "sphincs-shake-256f"),
which is designated in Katzenpost configurations as "Ed25519 Sphincs+".
Examples are provided below.</p>
<h3 id="intro-mix">Mix nodes</h3>
<p>The mix node is the fundamental building block of the mix
network.</p>
<p>Katzenpost mix nodes are arranged in a layered topology to achieve
the best levels of anonymity and ease of analysis while being flexible
enough to scale with traffic demands.</p>
<h3 id="intro-gateway">Gateway nodes</h3>
<p>Gateway nodes provide external client access to the mix network.
Because gateways are uniquely positioned to identify clients, they are
designed to have as little information about client behavior as
possible. Gateways are randomly selected and have no persistent
relationship with clients and no knowledge of whether a client's packets
are decoys or not. When client traffic through a gateway is slow, the
node additionally generates decoy traffic.</p>
<h3 id="intro-service">Service nodes</h3>
<p>Service nodes provide functionality requested by clients. They are
logically positioned at the deepest point of the mix network, with
incoming queries and outgoing replies both needing to traverse all
<em>n</em> layers of mix nodes. A service node's functionality may
involve storing messages, publishing information outside of the mixnet,
interfacing with a blockchain node, and so on. Service nodes also
process decoy packets.</p>
<h3 id="intro-client">Clients</h3>
<p>Client applications should be designed so that the following
conditions are met:</p>
<ul>
<li><p>Separate service requests from a client are unlinkable. Repeating
the same request may be lead to linkability.</p></li>
<li><p>Service nodes and clients have no persistent
relationship.</p></li>
<li><p>Cleints generate a stream of packets addressed to random or
pseudorandom services regardless of whether a real service request is
being made. Most of these packets will be decoy traffic.</p></li>
<li><p>Traffic from a client to a service node must be correctly coupled
with decoy traffic. This can mean that the service node is chosen
independently from traffic history, or that the transmitted packet
replaces a decoy packet that was meant to go to the desired
service.</p></li>
</ul>
<p>Katzenpost currently includes several client applications. All
applications make extensive use of Sphinx single-use reply blocks
(SURBs), which enable service nodes to send replies without knowing the
location of the client. Newer clients require a connection through the
client <em>connector</em>, which provides multiplexing and privilege
separation with a consequent reduction in processing overhead. These
clients also implement the Pigeonhole storage and BACAP protocols
detailed in <strong>Place-holder for research paper link</strong>.</p>
<p>The following client applications are available.</p>
<table>
<caption>Katzenpost clients</caption>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="header">
<th><p>Name</p></th>
<th><p>Needs connector</p></th>
<th><p>Description</p></th>
<th><p>Code</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p><strong>Ping</strong></p></td>
<td><p>no</p></td>
<td><p>The mix network equivalent of an ICMP ping utility, used for
network testing.</p></td>
<td><p>GitHub: <a
href="https://github.com/katzenpost/katzenpost/tree/main/ping">ping</a></p></td>
</tr>
<tr class="even">
<td><p><strong>Katzen</strong></p></td>
<td><p>no</p></td>
<td><p>A text chat client with file-transfer support.</p></td>
<td><p>GitHub: <a
href="https://github.com/katzenpost/katzen">katzen</a></p></td>
</tr>
<tr class="odd">
<td><p><strong>Status</strong></p></td>
<td><p>yes</p></td>
<td><p>An HTML page containing status information about the mix
network.</p></td>
<td><p>GitHub: <a
href="https://github.com/katzenpost/status">status</a></p></td>
</tr>
<tr class="even">
<td><p><strong>Worldmap</strong></p></td>
<td>yes</td>
<td><p>An HTML page with a world map showing geographic locations of mix
network nodes.</p></td>
<td><p>GitHub: <a
href="https://github.com/katzenpost/worldmap">worldmap</a></p></td>
</tr>
</tbody>
</table>
<h2 id="configuration">Configuring Katzenpost</h2>
<p>This section documents the configuration parameters for each type of
Katzenpost server node. Each node has its own configuration file in <a
href="https://toml.io/en/v1.0.0">TOML</a> format.</p>
<h3 id="auth-config">Configuring directory authorities</h3>
<p>The following configuration is drawn from the reference
implementation in
<code>katzenpost/docker/dirauth_mixnet/auth1/authority.toml</code>. In a
real-world mixnet, the component hosts would not be sharing a single IP
address. For more information about the test mixnet, see <strong><a
href="#container">Using the Katzenpost Docker test
network</a></strong>.</p>
<table>
<caption><strong>Directory authority (dirauth) configuration
sections</strong></caption>
<colgroup>
<col style="width: 100%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p><a href="#auth-server-section-config">Dirauth: Server
section</a></p></td>
</tr>
<tr class="even">
<td><p><a href="#auth-authorities-section-config">Dirauth:
section</a></p></td>
</tr>
<tr class="odd">
<td><p><a href="#auth-logging">Dirauth: Logging section</a></p></td>
</tr>
<tr class="even">
<td><p><a href="#auth-parameters">Dirauth: Parameters
section</a></p></td>
</tr>
<tr class="odd">
<td><p><a href="#auth-debug">Dirauth: Debug section</a></p></td>
</tr>
<tr class="even">
<td><p><a href="#auth-mixes-section-config">Dirauth: Mixes
sections</a></p></td>
</tr>
<tr class="odd">
<td><p><a href="#auth-gatewaynodes-section-config">Dirauth: GatewayNodes
section</a></p></td>
</tr>
<tr class="even">
<td><p><a href="#auth-servicenodes-section-config">Dirauth: ServiceNodes
sections</a></p></td>
</tr>
<tr class="odd">
<td><p><a href="#auth-topology">Dirauth: Topology section</a></p></td>
</tr>
<tr class="even">
<td><p><a href="#auth-sphinx-config">Dirauth: SphinxGeometry
section</a></p></td>
</tr>
</tbody>
</table>
<h4 id="auth-server-section-config">Dirauth: Server section</h4>
<p>The <code>Server</code> section configures mandatory basic parameters
for each directory authority.</p>
<pre><code>[Server]
    Identifier = &quot;auth1&quot;
    WireKEMScheme = &quot;xwing&quot;
    PKISignatureScheme = &quot;Ed25519 Sphincs+&quot;
    Addresses = [&quot;tcp://127.0.0.1:30001&quot;]
    DataDir = &quot;/dirauth_mixnet/auth1&quot;</code></pre>
<ul>
<li><p><strong>Identifier</strong></p>
<p>Specifies the human-readable identifier for a node, and must be
unique per mixnet. The identifier can be an FQDN but does not have to
be.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>WireKEMScheme</strong></p>
<p>Specifies the key encapsulation mechanism (KEM) scheme for the <a
href="https://eprint.iacr.org/2022/539">PQ Noise</a>-based wire protocol
(link layer) that nodes use to communicate with each other. PQ Noise is
a post-quantum variation of the <a
href="https://noiseprotocol.org/">Noise protocol framework</a>, which
algebraically transforms ECDH handshake patterns into KEM
encapsulate/decapsulate operations.</p>
<p>This configuration option supports the optional use of hybrid
post-quantum cryptography to strengthen security. The following KEM
schemes are supported:</p>
<ul>
<li><p><strong>Classical:</strong> "x25519", "x448"</p>
<div class="note">
<p>X25519 and X448 are actually non-interactive key-exchanges (NIKEs),
not KEMs. Katzenpost uses a hashed ElGamal cryptographic construction to
convert them from NIKEs to KEMs.</p>
</div></li>
<li><p><strong>Hybrid post-quantum:</strong> "mlkem768",
"sntrup4591761", "frodo640shake", "mceliece348864", "mceliece348864f",
"mceliece460896", "mceliece460896f", "mceliece6688128",
"mceliece6688128f", "mceliece6960119", "mceliece6960119f",
"mceliece8192128", "mceliece8192128f", "xwing", "Kyber768-X25519",
"MLKEM768-X25519", "MLKEM768-X448", "CTIDH511", "CTIDH512", "CTIDH1024",
"CTIDH2048", "CTIDH512-X25519", "CTIDH512-X25519"</p></li>
</ul>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>PKISignatureScheme</strong></p>
<p>Specifies the cryptographic signature scheme which will be used by
all components of the mix network when interacting with the PKI system.
Mix nodes sign their descriptors using this signature scheme, and
dirauth nodes similarly sign PKI documents using the same scheme.</p>
<p>The following signature schemes are supported: "ed25519", "ed448",
"Ed25519 Sphincs+", "Ed448-Sphincs+", "Ed25519-Dilithium2",
"Ed448-Dilithium3"</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>Addresses</strong></p>
<p>Specifies a list of one or more address URLs in a format that
contains the transport protocol, IP address, and port number that the
node will bind to for incoming connections. Katzenpost supports URLs
with that start with either "tcp://" or "quic://" such as:
["tcp://192.168.1.1:30001"] and ["quic://192.168.1.1:40001"].</p>
<p>Type: []string</p>
<p>Required: Yes</p></li>
<li><p><strong>DataDir</strong></p>
<p>Specifies the absolute path to a node's state directory. This is
where<code>persistence.db</code> is written to disk and where a node
stores its cryptographic key materials when started with the "-g"
command-line option.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
</ul>
<h4 id="auth-authorities-section-config">Dirauth:
<code>Authorities</code> section</h4>
<p>An <code>Authorities</code> section is configured for each peer
authority. We recommend using <a
href="https://quickref.me/toml.html">TOML's style</a> for multi-line
quotations for key materials.</p>
<pre><code>[[Authorities]]
    Identifier = &quot;auth1&quot;
    IdentityPublicKey = &quot;&quot;&quot;
-----BEGIN ED25519 PUBLIC KEY-----
dYpXpbozjFfqhR45ZC2q97SOOsXMANdHaEdXrP42CJk=
-----END ED25519 PUBLIC KEY-----
&quot;&quot;&quot;
    PKISignatureScheme = &quot;Ed25519&quot;
    LinkPublicKey = &quot;&quot;&quot;
-----BEGIN XWING PUBLIC KEY-----
ooQBPYNdmfwnxXmvnljPA2mG5gWgurfHhbY87DMRY2tbMeZpinJ5BlSiIecprnmm
QqxcS9o36IS62SVMlOUkw+XEZGVvc9wJqHpgEgVJRAs1PCR8cUAdM6QIYLWt/lkf
SPKDCtZ3GiSIOzMuaglo2tarIPEv1AY7r9B0xXOgSKMkGyBkCfw1VBZf46MM26NL
...
gHtNyQJnXski52O03JpZRIhR40pFOhAAcMMAZDpMTVoxlcdR6WA4SlBiSceeJBgY
Yp9PlGhCimx9am99TrdLoLCdTHB6oowt8tss3POpIOxaSlguyeym/sBhkUrnXOgN
ldMtDsvvc9KUfE4I0+c+XQ==
-----END XWING PUBLIC KEY-----
    &quot;&quot;&quot;
    WireKEMScheme = &quot;xwing&quot;
    Addresses = [&quot;tcp://127.0.0.1:30001&quot;]</code></pre>
<ul>
<li><p><strong>Identifier</strong></p>
<p>Specifies the human-readable identifier for the node which must be
unique per mixnet. The identifier can be an FQDN but does not have to
be.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>IdentityPublicKey</strong></p>
<p>String containing the node's public identity key in PEM format.
<code>IdentityPublicKey</code> is the node's permanent identifier and is
used to verify cryptographic signatures produced by its private identity
key.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>PKISignatureScheme</strong></p>
<p>Specifies the cryptographic signature scheme used by all directory
authority nodes. <code>PKISignatureScheme</code> must match the scheme
specified in the <code>Server</code> section of the configuration.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>LinkPublicKey</strong></p>
<p>String containing the peer's public link-layer key in PEM format.
<code>LinkPublicKey</code> must match the specified
<code>WireKEMScheme</code>.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>WireKEMScheme</strong></p>
<p>Specifies the key encapsulation mechanism (KEM) scheme for the <a
href="https://eprint.iacr.org/2022/539">PQ Noise</a>-based wire protocol
(link layer) that nodes use to communicate with each other. PQ Noise is
a post-quantum variation of the <a
href="https://noiseprotocol.org/">Noise protocol framework</a>, which
algebraically transforms ECDH handshake patterns into KEM
encapsulate/decapsulate operations.</p>
<p>This configuration option supports the optional use of hybrid
post-quantum cryptography to strengthen security. The following KEM
schemes are supported:</p>
<ul>
<li><p><strong>Classical:</strong> "x25519", "x448"</p>
<div class="note">
<p>X25519 and X448 are actually non-interactive key-exchanges (NIKEs),
not KEMs. Katzenpost uses a hashed ElGamal cryptographic construction to
convert them from NIKEs to KEMs.</p>
</div></li>
<li><p><strong>Hybrid post-quantum:</strong> "mlkem768",
"sntrup4591761", "frodo640shake", "mceliece348864", "mceliece348864f",
"mceliece460896", "mceliece460896f", "mceliece6688128",
"mceliece6688128f", "mceliece6960119", "mceliece6960119f",
"mceliece8192128", "mceliece8192128f", "xwing", "Kyber768-X25519",
"MLKEM768-X25519", "MLKEM768-X448", "CTIDH511", "CTIDH512", "CTIDH1024",
"CTIDH2048", "CTIDH512-X25519", "CTIDH512-X25519"</p></li>
</ul>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>Addresses</strong></p>
<p>Specifies a list of one or more address URLs in a format that
contains the transport protocol, IP address, and port number that the
node will bind to for incoming connections. Katzenpost supports URLs
with that start with either "tcp://" or "quic://" such as:
["tcp://192.168.1.1:30001"] and ["quic://192.168.1.1:40001"].</p>
<p>Type: []string</p>
<p>Required: Yes</p></li>
</ul>
<h4 id="auth-logging">Dirauth: Logging section</h4>
<h5 class="unnumbered"></h5>
<div class="informalexample">
<p>The <code>Logging</code> configuration section controls logging
behavior across Katzenpost.</p>
<pre><code>[Logging]
                Disable = false
                File = &quot;katzenpost.log&quot;
                Level = &quot;INFO&quot;</code></pre>
<ul>
<li><p><strong>Disable</strong></p>
<p>If <strong>true&gt;</strong>, logging is disabled.</p>
<p>Type: bool</p>
<p>Required: No</p></li>
<li><p><strong>File</strong></p>
<p>Specifies the log file. If omitted, <code>stdout</code> is used.</p>
<p>An absolute or relative file path can be specified. A relative path
is relative to the DataDir specified in the <code>Server</code> section
of the configuration.</p>
<p>Type: string</p>
<p>Required: No</p></li>
<li><p><strong>Level</strong></p>
<p>Supported logging level values are ERROR | WARNING | NOTICE |INFO |
DEBUG.</p>
<p>Type: string</p>
<p>Required: No</p>
<div class="warning">
<p>The DEBUG log level is unsafe for production use.</p>
</div></li>
</ul>
</div>
<h4 id="auth-parameters">Dirauth: Parameters section</h4>
<p>The <code>Parameters</code> section contains the network
parameters.</p>
<pre><code>[Parameters]
    SendRatePerMinute = 0
    Mu = 0.005
    MuMaxDelay = 1000
    LambdaP = 0.001
    LambdaPMaxDelay = 1000
    LambdaL = 0.0005
    LambdaLMaxDelay = 1000
    LambdaD = 0.0005
    LambdaDMaxDelay = 3000
    LambdaM = 0.0005
    LambdaG = 0.0
    LambdaMMaxDelay = 100
    LambdaGMaxDelay = 100</code></pre>
<ul>
<li><p><strong>SendRatePerMinute</strong></p>
<p>Specifies the maximum allowed rate of packets per client per gateway
node. Rate limiting is done on the gateway nodes.</p>
<p>Type: uint64</p>
<p>Required: Yes</p></li>
<li><p><strong>Mu</strong></p>
<p>Specifies the inverse of the mean of the exponential distribution
from which the Sphinx packet per-hop mixing delay will be sampled.</p>
<p>Type: float64</p>
<p>Required: Yes</p></li>
<li><p><strong>MuMaxDelay</strong></p>
<p>Specifies the maximum Sphinx packet per-hop mixing delay in
milliseconds.</p>
<p>Type: uint64</p>
<p>Required: Yes</p></li>
<li><p><strong>LambdaP</strong></p>
<p>Specifies the inverse of the mean of the exponential distribution
that clients sample to determine the time interval between sending
messages, whether actual messages from the FIFO egress queue or decoy
messages if the queue is empty.</p>
<p>Type: float64</p>
<p>Required: Yes</p></li>
<li><p><strong>LambdaPMaxDelay</strong></p>
<p>Specifies the maximum send delay interval for LambdaP in
milliseconds.</p>
<p>Type: uint64</p>
<p>Required: Yes</p></li>
<li><p><strong>LambdaL</strong></p>
<p>Specifies the inverse of the mean of the exponential distribution
that clients sample to determine the delay interval between loop
decoys.</p>
<p>Type: float64</p>
<p>Required: Yes</p></li>
<li><p><strong>LambdaLMaxDelay</strong></p>
<p>Specifies the maximum send delay interval for LambdaL in
milliseconds.</p>
<p>Type: uint64</p>
<p>Required: Yes</p></li>
<li><p><strong>LambdaD</strong></p>
<p>LambdaD is the inverse of the mean of the exponential distribution
that clients sample to determine the delay interval between decoy drop
messages.</p>
<p>Type: float64</p>
<p>Required: Yes</p></li>
<li><p><strong>LambdaDMaxDelay</strong></p>
<p>Specifies the maximum send interval in for LambdaD in
milliseconds.</p>
<p>Type: uint64</p>
<p>Required: Yes</p></li>
<li><p><strong>LambdaM</strong></p>
<p>LambdaM is the inverse of the mean of the exponential distribution
that mix nodes sample to determine the delay between mix loop
decoys.</p>
<p>Type: float64</p>
<p>Required: Yes</p></li>
<li><p><strong>LambdaG</strong></p>
<p>LambdaG is the inverse of the mean of the exponential distribution
that gateway nodes to select the delay between gateway node decoys.</p>
<div class="warning">
<p>Do not set this value manually in the TOML configuration file. The
field is used internally by the dirauth server state machine.</p>
</div>
<p>Type: float64</p>
<p>Required: Yes</p></li>
<li><p><strong>LambdaMMaxDelay</strong></p>
<p>Specifies the maximum delay for LambdaM in milliseconds.</p>
<p>Type: uint64</p>
<p>Required: Yes</p></li>
<li><p><strong>LambdaGMaxDelay</strong></p>
<p>Specifies the maximum delay for LambdaG in milliseconds.</p>
<p>Type: uint64</p>
<p>Required: Yes</p></li>
</ul>
<h4 id="auth-debug">Dirauth: Debug section</h4>
<pre><code>[Debug]
    Layers = 3
    MinNodesPerLayer = 1
    GenerateOnly = false</code></pre>
<ul>
<li><p><strong>Layers</strong></p>
<p>Specifies the number of non-service-provider layers in the network
topology.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>MinNodesrPerLayer</strong></p>
<p>Specifies the minimum number of nodes per layer required to form a
valid consensus document.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>GenerateOnly</strong></p>
<p>If <strong>true&gt;</strong>, the server halts and cleans up the data
directory immediately after long-term key generation.</p>
<p>Type: bool</p>
<p>Required: No</p></li>
</ul>
<h4 id="auth-mixes-section-config">Dirauth: Mixes sections</h4>
<p>The <code>Mixes</code> configuration sections list mix nodes that are
known to the authority.</p>
<pre><code>[[Mixes]]
    Identifier = &quot;mix1&quot;
    IdentityPublicKeyPem = &quot;../mix1/identity.public.pem&quot;

[[Mixes]]
    Identifier = &quot;mix2&quot;
    IdentityPublicKeyPem = &quot;../mix2/identity.public.pem&quot;

[[Mixes]]
    Identifier = &quot;mix3&quot;
    IdentityPublicKeyPem = &quot;../mix3/identity.public.pem&quot;</code></pre>
<ul>
<li><p><strong>Identifier</strong></p>
<p>Specifies the human-readable identifier for a mix node, and must be
unique per mixnet. The identifier can be an FQDN but does not have to
be.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>IdentityPublicKeyPem</strong></p>
<p>Path and file name of a mix node's public identity signing key, also
known as the identity key, in PEM format.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
</ul>
<h4 id="auth-gatewaynodes-section-config">Dirauth: GatewayNodes
section</h4>
<p>The <code>GatewayNodes</code> sections list gateway nodes that are
known to the authority.</p>
<pre><code>[[GatewayNodes]]
    Identifier = &quot;gateway1&quot;
    IdentityPublicKeyPem = &quot;../gateway1/identity.public.pem&quot;</code></pre>
<ul>
<li><p><strong>Identifier</strong></p>
<p>Specifies the human-readable identifier for a gateway node, and must
be unique per mixnet. Identifier can be an FQDN but does not have to
be.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>IdentityPublicKeyPem</strong></p>
<p>Path and file name of a gateway node's public identity signing key,
also known as the identity key, in PEM format.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
</ul>
<h4 id="auth-servicenodes-section-config">Dirauth: ServiceNodes
sections</h4>
<p>The <code>ServiceNodes</code> sections list service nodes that are
known to the authority.</p>
<pre><code>[[ServiceNodes]]
    Identifier = &quot;servicenode1&quot;
    IdentityPublicKeyPem = &quot;../servicenode1/identity.public.pem&quot;</code></pre>
<ul>
<li><p><strong>Identifier</strong></p>
<p>Specifies the human-readable identifier for a service node, and must
be unique per mixnet. Identifier can be an FQDN but does not have to
be.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>IdentityPublicKeyPem</strong></p>
<p>Path and file name of a service node's public identity signing key,
also known as the identity key, in PEM format.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
</ul>
<h4 id="auth-topology">Dirauth: Topology section</h4>
<p>The <code>Topology</code> section defines the layers of the mix
network and the mix nodes in each layer.</p>
<pre><code>[Topology]
                    
    [[Topology.Layers]]
    
        [[Topology.Layers.Nodes]]
            Identifier = &quot;mix1&quot;
            IdentityPublicKeyPem = &quot;../mix1/identity.public.pem&quot;
    
    [[Topology.Layers]]
    
        [[Topology.Layers.Nodes]]
            Identifier = &quot;mix2&quot;
            IdentityPublicKeyPem = &quot;../mix2/identity.public.pem&quot;
    
    [[Topology.Layers]]
    
        [[Topology.Layers.Nodes]]
            Identifier = &quot;mix3&quot;
            IdentityPublicKeyPem = &quot;../mix3/identity.public.pem&quot;</code></pre>
<ul>
<li><p><strong>Identifier</strong></p>
<p>Specifies the human-readable identifier for a node, and must be
unique per mixnet. The identifier can be an FQDN but does not have to
be.</p>
<p>Type: string</p></li>
<li><p><strong>IdentityPublicKeyPem</strong></p>
<p>Path and file name of a mix node's public identity signing key, also
known as the identity key, in PEM format.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
</ul>
<h4 id="auth-sphinx-config">Dirauth: SphinxGeometry section</h4>
<p>Sphinx is an encrypted nested-packet format designed primarily for
mixnets. The <a
href="https://www.freehaven.net/anonbib/cache/DBLP:conf/sp/DanezisG09.pdf">original
Sphinx paper</a> described a non-interactive key exchange (NIKE)
employing classical encryption. The Katzenpost implementation strongly
emphasizes configurability, supporting key encapsulation mechanisms
(KEMs) as well as NIKEs, and enabling the use of either classical or
hybrid post-quantum cryptography. Hybrid constructions offset the
newness of post-quantum algorithms by offering heavily tested classical
algorithms as a fallback.</p>
<div class="note">
<p>Sphinx, the nested-packet format, should not be confused with <a
href="http://sphincs.org/index.html">Sphincs or Sphincs+</a>, which are
post-quantum signature schemes.</p>
</div>
<p>Katzenpost Sphinx also relies on the following classical
cryptographic primitives:</p>
<ul>
<li><p>CTR-AES256, a stream cipher</p></li>
<li><p>HMAC-SHA256, a message authentication code (MAC)
function</p></li>
<li><p>HKDF-SHA256, a key derivation function (KDF)</p></li>
<li><p>AEZv5, a strong pseudorandom permutation (SPRP)</p></li>
</ul>
<p>All dirauths must be configured to use the same
<code>SphinxGeometry</code> parameters. Any geometry not advertised by
the PKI document will fail. Each dirauth publishes the hash of its
<code>SphinxGeometry</code> parameters in the PKI document for
validation by its peer dirauths.</p>
<h5 class="unnumbered"></h5>
<div class="informalexample">
<p>The <code>SphinxGeometry</code> section defines parameters for the
Sphinx encrypted nested-packet format used internally by Katzenpost.</p>
<div class="warning">
<p>The values in the <code>SphinxGeometry</code> configuration section
must be programmatically generated by <code>gensphinx</code>. Many of
the parameters are interdependent and cannot be individually modified.
Do not modify the these values by hand.</p>
</div>
<p>The settings in this section are generated by the
<code>gensphinx</code> utility, which computes the Sphinx geometry based
on the following user-supplied directives:</p>
<ul>
<li><p>The number of mix node layers (not counting gateway and service
nodes)</p></li>
<li><p>The length of the application-usable packet payload</p></li>
<li><p>The selected NIKE or KEM scheme</p></li>
</ul>
<p>The output in TOML should then be pasted unchanged into the node's
configuration file, as shown below. For more information, see <a
href="#gensphinx">Appendix: Using </a>.</p>
<pre><code>[SphinxGeometry]
                PacketLength = 3082
                NrHops = 5
                HeaderLength = 476
                RoutingInfoLength = 410
                PerHopRoutingInfoLength = 82
                SURBLength = 572
                SphinxPlaintextHeaderLength = 2
                PayloadTagLength = 32
                ForwardPayloadLength = 2574
                UserForwardPayloadLength = 2000
                NextNodeHopLength = 65
                SPRPKeyMaterialLength = 64
                NIKEName = &quot;x25519&quot;
                KEMName = &quot;&quot;</code></pre>
<ul>
<li><p><strong>PacketLength</strong></p>
<p>The length of a Sphinx packet in bytes.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>NrHops</strong></p>
<p>The number of hops a Sphinx packet takes through the mixnet. Because
packet headers hold destination information for each hop, the size of
the header increases linearly with the number of hops.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>HeaderLength</strong></p>
<p>The total length of the Sphinx packet header in bytes.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>RoutingInfoLength</strong></p>
<p>The total length of the routing information portion of the Sphinx
packet header.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>PerHopRoutingInfoLength</strong></p>
<p>The length of the per-hop routing information in the Sphinx packet
header.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>SURBLength</strong></p>
<p>The length of a single-use reply block (SURB).</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>SphinxPlaintextHeaderLength</strong></p>
<p>The length of the plaintext Sphinx packet header.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>PayloadTagLength</strong></p>
<p>The length of the payload tag.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>ForwardPayloadLength</strong></p>
<p>The total size of the payload.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>UserForwardPayloadLength</strong></p>
<p>The size of the usable payload.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>NextNodeHopLength</strong></p>
<p>The <code>NextNodeHopLength</code> is derived from the largest
routing-information block that we expect to encounter. Other packets
have <code>NextNodeHop</code> + <code>NodeDelay</code> sections, or a
<code>Recipient</code> section, both of which are shorter.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>SPRPKeyMaterialLength</strong></p>
<p>The length of the strong pseudo-random permutation (SPRP) key.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>NIKEName</strong></p>
<p>The name of the non-interactive key exchange (NIKE) scheme used by
Sphinx packets.</p>
<p><code>NIKEName</code> and <code>KEMName</code> are mutually
exclusive.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>KEMName</strong></p>
<p>The name of the key encapsulation mechanism (KEM) used by Sphinx
packets.</p>
<p><code>NIKEName</code> and <code>KEMName</code> are mutually
exclusive.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
</ul>
</div>
<h3 id="mix-config">Configuring mix nodes</h3>
<p>The following configuration is drawn from the reference
implementation in
<code>katzenpost/docker/dirauth_mixnet/mix1/katzenpost.toml</code>. In a
real-world mixnet, the component hosts would not be sharing a single IP
address. For more information about the test mixnet, see <strong><a
href="#container">Using the Katzenpost Docker test
network</a></strong>.</p>
<table>
<caption>Mix node configuration sections</caption>
<colgroup>
<col style="width: 100%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p><a href="#mix-server-section-config">Mix node: Server
section</a></p></td>
</tr>
<tr class="even">
<td><p><a href="#mix-logging-config">Mix node: Logging
section</a></p></td>
</tr>
<tr class="odd">
<td><p><a href="#mix-pki-config">Mix node: PKI section</a></p></td>
</tr>
<tr class="even">
<td><p><a href="#mix-management-config">Mix node: Management
section</a></p></td>
</tr>
<tr class="odd">
<td><p><a href="#mix-sphinx-config">Mix node: SphinxGeometry
section</a></p></td>
</tr>
<tr class="even">
<td><p><a href="#mix-debug-config">Mix node: Debug section</a></p></td>
</tr>
</tbody>
</table>
<h4 id="mix-server-section-config">Mix node: Server section</h4>
<p>The <code>Server</code> section configures mandatory basic parameters
for each server node.</p>
<pre><code>[Server]
  Identifier = &quot;mix1&quot;
  WireKEM = &quot;xwing&quot;
  PKISignatureScheme = &quot;Ed25519&quot;
  Addresses = [&quot;127.0.0.1:30008&quot;]
  OnlyAdvertiseAltAddresses = false
  MetricsAddress = &quot;127.0.0.1:30009&quot;
  DataDir = &quot;/dirauth_mixnet/mix1&quot;
  IsGatewayNode = false
  IsServiceNode = false
  [Server.AltAddresses]</code></pre>
<h5 class="unnumbered"></h5>
<div class="informalexample">
<ul>
<li><p><strong>Identifier</strong></p>
<p>Specifies the human-readable identifier for a node, and must be
unique per mixnet. The identifier can be an FQDN but does not have to
be.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>WireKEM</strong></p>
<p>WireKEM specifies the key encapsulation mechanism (KEM) scheme for
the <a href="https://eprint.iacr.org/2022/539">PQ Noise</a>-based wire
protocol (link layer) that nodes use to communicate with each other. PQ
Noise is a post-quantum variation of the <a
href="https://noiseprotocol.org/">Noise protocol framework</a>, which
algebraically transforms ECDH handshake patterns into KEM
encapsulate/decapsulate operations.</p>
<p>This configuration option supports the optional use of hybrid
post-quantum cryptography to strengthen security. The following KEM
schemes are supported:</p>
<ul>
<li><p><strong>Classical:</strong> "x25519", "x448"</p>
<div class="note">
<p>X25519 and X448 are actually non-interactive key-exchanges (NIKEs),
not KEMs. Katzenpost uses a Hashed ElGamal cryptographic construction to
convert them from NIKEs to KEMs.</p>
</div></li>
<li><p><strong>Hybrid post-quantum:</strong> "mlkem768",
"sntrup4591761", "frodo640shake", "mceliece348864", "mceliece348864f",
"mceliece460896", "mceliece460896f", "mceliece6688128",
"mceliece6688128f", "mceliece6960119", "mceliece6960119f",
"mceliece8192128", "mceliece8192128f", "xwing", "Kyber768-X25519",
"MLKEM768-X25519", "MLKEM768-X448", "CTIDH511", "CTIDH512", "CTIDH1024",
"CTIDH2048", "CTIDH512-X25519", "CTIDH512-X25519"</p></li>
</ul>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>PKISignatureScheme</strong></p>
<p>Specifies the cryptographic signature scheme that will be used by all
components of the mix network when interacting with the PKI system. Mix
nodes sign their descriptors using this signature scheme, and dirauth
nodes similarly sign PKI documents using the same scheme.</p>
<p>The following signature schemes are supported:</p>
<ul>
<li><p><strong>Classical:</strong> "ed25519", "ed448"</p></li>
<li><p><strong>Hybrid post-quantum:</strong> "Ed25519 Sphincs+",
"Ed448-Sphincs+", "Ed25519-Dilithium2", "Ed448-Dilithium3"</p></li>
</ul>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>Addresses</strong></p>
<p>Specifies a list of one or more address URLs in a format that
contains the transport protocol, IP address, and port number that the
server will bind to for incoming connections. Katzenpost supports URLs
with that start with either "tcp://" or "quic://" such as:
["tcp://192.168.1.1:30001"] and ["quic://192.168.1.1:40001"].</p>
<p>Type: []string</p>
<p>Required: Yes</p></li>
<li><p><strong>BindAddresses</strong></p>
<p>If <strong>true</strong>, allows setting of listener addresses that
the server will bind to and accept connections on. These addresses are
not advertised in the PKI.</p>
<p>Type: bool</p>
<p>Required: No</p></li>
<li><p><strong>MetricsAddress</strong></p>
<p>Specifies the address/port to bind the Prometheus metrics endpoint
to.</p>
<p>Type: string</p>
<p>Required: No</p></li>
<li><p><strong>DataDir</strong></p>
<p>Specifies the absolute path to a node's state directory. This is
where persistence.db is written to disk and where a node stores its
cryptographic key materials when started with the "-g" commmand-line
option.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>IsGatewayNode</strong></p>
<p>If <strong>true&gt;</strong>, the server is a gateway node.</p>
<p>Type: bool</p>
<p>Required: No</p></li>
<li><p><strong>IsServiceNode</strong></p>
<p>If <strong>true&gt;</strong>, the server is a service node.</p>
<p>Type: bool</p>
<p>Required: No</p></li>
</ul>
</div>
<h4 id="mix-logging-config">Mix node: Logging section</h4>
<h5 class="unnumbered"></h5>
<div class="informalexample">
<p>The <code>Logging</code> configuration section controls logging
behavior across Katzenpost.</p>
<pre><code>[Logging]
                Disable = false
                File = &quot;katzenpost.log&quot;
                Level = &quot;INFO&quot;</code></pre>
<ul>
<li><p><strong>Disable</strong></p>
<p>If <strong>true&gt;</strong>, logging is disabled.</p>
<p>Type: bool</p>
<p>Required: No</p></li>
<li><p><strong>File</strong></p>
<p>Specifies the log file. If omitted, <code>stdout</code> is used.</p>
<p>An absolute or relative file path can be specified. A relative path
is relative to the DataDir specified in the <code>Server</code> section
of the configuration.</p>
<p>Type: string</p>
<p>Required: No</p></li>
<li><p><strong>Level</strong></p>
<p>Supported logging level values are ERROR | WARNING | NOTICE |INFO |
DEBUG.</p>
<p>Type: string</p>
<p>Required: No</p>
<div class="warning">
<p>The DEBUG log level is unsafe for production use.</p>
</div></li>
</ul>
</div>
<h4 id="mix-pki-config">Mix node: PKI section</h4>
<h5 class="unnumbered"></h5>
<div class="informalexample">
<p>The <code>PKI</code> section contains the directory authority
configuration for a mix, gateway, or service node.</p>
<pre><code>[PKI]
[PKI.dirauth]

    [[PKI.dirauth.Authorities]]
        Identifier = &quot;auth1&quot;
        IdentityPublicKey = &quot;&quot;&quot;-----BEGIN ED25519 PUBLIC KEY-----
tqN6tpOVotHWXKCszVn2kS7vAZjQpvJjQF3Qz/Qwhyg=
-----END ED25519 PUBLIC KEY-----
&quot;&quot;&quot;
        PKISignatureScheme = &quot;Ed25519&quot;
        LinkPublicKey = &quot;&quot;&quot;-----BEGIN XWING PUBLIC KEY-----
JnJ8ztQEIjAkKJcpuZvJAdkWjBim/5G5d8yoosEQHeGJeeBqNPdm2AitUbpiQPcd
tNCo9DxuC9Ieqmsfw0YpV6AtOOsaInA6QnHDYcuBfZcQL5MU4+t2TzpBZQYlrSED
hPCKrAG+8GEUl6akseG371WQzEtPpEWWCJCJOiS/VDFZT7eKrldlumN6gfiB84sR
...
arFh/WKwYJUj+aGBsFYSqGdzC6MdY4x/YyFe2ze0MJEjThQE91y1d/LCQ3Sb7Ri+
u6PBi3JU2qzlPEejDKwK0t5tMNEAkq8iNrpRTdD/hS0gR+ZIN8Z9QKh7Xf94FWG2
H+r8OaqImQhgHabrWRDyLg==
-----END XWING PUBLIC KEY-----
&quot;&quot;&quot;
        WireKEMScheme = &quot;xwing&quot;
        Addresses = [&quot;127.0.0.1:30001&quot;]

    [[PKI.dirauth.Authorities]]
        Identifier = &quot;auth2&quot;
        IdentityPublicKey = &quot;&quot;&quot;-----BEGIN ED25519 PUBLIC KEY-----
O51Ty2WLu4C1ETMa29s03bMXV72gnjJfTfwLV++LVBI=
-----END ED25519 PUBLIC KEY-----    
&quot;&quot;&quot;
        PKISignatureScheme = &quot;Ed25519&quot;
        LinkPublicKey = &quot;&quot;&quot;-----BEGIN XWING PUBLIC KEY-----
TtQkg2XKUnY602FFBaPJ+zpN0Twy20cwyyFxh7FNUjaXA9MAJXs0vUwFbJc6BjYv
f+olKnlIKFSmDvcF74U6w1F0ObugwTNKNxeYKPKhX4FiencUbRwkHoYHdtZdSctz
TKy08qKQyCAccqCRpdo6ZtYXPAU+2rthjYTOL7Zn+7SHUKCuJClcPnvEYjVcJxtZ
...
ubJIe5U4nMJbBkOqr7Kq6niaEkiLODa0tkpB8tKMYTMBdcYyHSXCzpo7U9sb6LAR
HktiTBDtRXviu2vbw7VRXhkMW2kjYZDtReQ5sAse04DvmD49zgTp1YxYW+wWFaL3
37X7/SNuLdHX4PHZXIWHBQ==
-----END XWING PUBLIC KEY-----  
&quot;&quot;&quot;
        WireKEMScheme = &quot;xwing&quot;
        Addresses = [&quot;127.0.0.1:30002&quot;]

    [[PKI.dirauth.Authorities]]
        Identifier = &quot;auth3&quot;
        IdentityPublicKey = &quot;&quot;&quot;-----BEGIN ED25519 PUBLIC KEY-----
zQvydRYJq3npeLcg1NqIf+SswEKE5wFmiwNsI9Z1whQ=
-----END ED25519 PUBLIC KEY-----
&quot;&quot;&quot;
        PKISignatureScheme = &quot;Ed25519&quot;
        LinkPublicKey = &quot;&quot;&quot;
-----BEGIN XWING PUBLIC KEY-----
OYK9FiC53xwZ1VST3jDOO4tR+cUMSVRSekmigZMChSjDCPZbKut8TblxtlUfc/yi
Ugorz4NIvYPMWUt3QPwS2UWq8/HMWXNGPUiAevg12+oV+jOJXaJeCfY24UekJnSw
TNcdGaFZFSR0FocFcPBBnrK1M2B8w8eEUKQIsXRDM3x/8aRIuDif+ve8rSwpgKeh
...
OdVD3yw7OOS8uPZLORGQFyJbHtVmFPVvwja4G/o2gntAoHUZ2LiJJakpVhhlSyrI
yuzvwwFtZVfWtNb5gAKZCyg0aduR3qgd7MPerRF+YopZk3OCRpC02YxfUZrHv398
FZWJFK0R8iU52CEUxVpXTA==
-----END XWING PUBLIC KEY-----  
&quot;&quot;&quot;
        WireKEMScheme = &quot;xwing&quot;
        Addresses = [&quot;127.0.0.1:30003&quot;]</code></pre>
<ul>
<li><p><strong>Identifier</strong></p>
<p>Specifies the human-readable identifier for a node, which must be
unique per mixnet. The identifier can be an FQDN but does not have to
be.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>IdentityPublicKey</strong></p>
<p>String containing the node's public identity key in PEM format.
<code>IdentityPublicKey</code> is the node's permanent identifier and is
used to verify cryptographic signatures produced by its private identity
key.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>PKISignatureScheme</strong></p>
<p>Specifies the cryptographic signature scheme that will be used by all
components of the mix network when interacting with the PKI system. Mix
nodes sign their descriptors using this signature scheme, and dirauth
nodes similarly sign PKI documents using the same scheme.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>LinkPublicKey</strong></p>
<p>String containing the peer's public link-layer key in PEM format.
<code>LinkPublicKey</code> must match the specified
<code>WireKEMScheme</code>.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>WireKEMScheme</strong></p>
<p>The name of the wire protocol key-encapsulation mechanism (KEM) to
use.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>Addresses</strong></p>
<p>Specifies a list of one or more address URLs in a format that
contains the transport protocol, IP address, and port number that the
server will bind to for incoming connections. Katzenpost supports URLs
that start with either "tcp://" or "quic://" such as:
["tcp://192.168.1.1:30001"] and ["quic://192.168.1.1:40001"].</p>
<p>Type: []string</p>
<p>Required: Yes</p></li>
</ul>
</div>
<h4 id="mix-management-config">Mix node: Management section</h4>
<h5 class="unnumbered"></h5>
<div class="informalexample">
<p>The <code>Management</code> section specifies connectivity
information for the Katzenpost control protocol which can be used to
make run-time configuration changes. A configuration resembles the
following:</p>
<pre><code>[Management]
   Enable = false
   Path = &quot;/dirauth_mixnet/mix1/management_sock&quot;</code></pre>
<ul>
<li><p><strong>Enable</strong></p>
<p>If <strong>true&gt;</strong>, the management interface is
enabled.</p>
<p>Type: bool</p>
<p>Required: No</p></li>
<li><p><strong>Path</strong></p>
<p>Specifies the path to the management interface socket. If left empty,
then <code>management_sock</code> is located in the configuration's
defined <code>DataDir</code>&gt;.</p>
<p>Type: string</p>
<p>Required: No</p></li>
</ul>
</div>
<h4 id="mix-sphinx-config">Mix node: SphinxGeometry section</h4>
<h5 class="unnumbered"></h5>
<div class="informalexample">
<p>The <code>SphinxGeometry</code> section defines parameters for the
Sphinx encrypted nested-packet format used internally by Katzenpost.</p>
<div class="warning">
<p>The values in the <code>SphinxGeometry</code> configuration section
must be programmatically generated by <code>gensphinx</code>. Many of
the parameters are interdependent and cannot be individually modified.
Do not modify the these values by hand.</p>
</div>
<p>The settings in this section are generated by the
<code>gensphinx</code> utility, which computes the Sphinx geometry based
on the following user-supplied directives:</p>
<ul>
<li><p>The number of mix node layers (not counting gateway and service
nodes)</p></li>
<li><p>The length of the application-usable packet payload</p></li>
<li><p>The selected NIKE or KEM scheme</p></li>
</ul>
<p>The output in TOML should then be pasted unchanged into the node's
configuration file, as shown below. For more information, see <a
href="#gensphinx">Appendix: Using </a>.</p>
<pre><code>[SphinxGeometry]
                PacketLength = 3082
                NrHops = 5
                HeaderLength = 476
                RoutingInfoLength = 410
                PerHopRoutingInfoLength = 82
                SURBLength = 572
                SphinxPlaintextHeaderLength = 2
                PayloadTagLength = 32
                ForwardPayloadLength = 2574
                UserForwardPayloadLength = 2000
                NextNodeHopLength = 65
                SPRPKeyMaterialLength = 64
                NIKEName = &quot;x25519&quot;
                KEMName = &quot;&quot;</code></pre>
<ul>
<li><p><strong>PacketLength</strong></p>
<p>The length of a Sphinx packet in bytes.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>NrHops</strong></p>
<p>The number of hops a Sphinx packet takes through the mixnet. Because
packet headers hold destination information for each hop, the size of
the header increases linearly with the number of hops.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>HeaderLength</strong></p>
<p>The total length of the Sphinx packet header in bytes.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>RoutingInfoLength</strong></p>
<p>The total length of the routing information portion of the Sphinx
packet header.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>PerHopRoutingInfoLength</strong></p>
<p>The length of the per-hop routing information in the Sphinx packet
header.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>SURBLength</strong></p>
<p>The length of a single-use reply block (SURB).</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>SphinxPlaintextHeaderLength</strong></p>
<p>The length of the plaintext Sphinx packet header.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>PayloadTagLength</strong></p>
<p>The length of the payload tag.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>ForwardPayloadLength</strong></p>
<p>The total size of the payload.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>UserForwardPayloadLength</strong></p>
<p>The size of the usable payload.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>NextNodeHopLength</strong></p>
<p>The <code>NextNodeHopLength</code> is derived from the largest
routing-information block that we expect to encounter. Other packets
have <code>NextNodeHop</code> + <code>NodeDelay</code> sections, or a
<code>Recipient</code> section, both of which are shorter.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>SPRPKeyMaterialLength</strong></p>
<p>The length of the strong pseudo-random permutation (SPRP) key.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>NIKEName</strong></p>
<p>The name of the non-interactive key exchange (NIKE) scheme used by
Sphinx packets.</p>
<p><code>NIKEName</code> and <code>KEMName</code> are mutually
exclusive.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>KEMName</strong></p>
<p>The name of the key encapsulation mechanism (KEM) used by Sphinx
packets.</p>
<p><code>NIKEName</code> and <code>KEMName</code> are mutually
exclusive.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
</ul>
</div>
<h4 id="mix-debug-config">Mix node: Debug section</h4>
<h5 class="unnumbered"></h5>
<div class="informalexample">
<p>The <code>Debug</code> section is the Katzenpost server debug
configuration for advanced tuning.</p>
<pre><code>[Debug]
                NumSphinxWorkers = 16
                NumServiceWorkers = 3
                NumGatewayWorkers = 3
                NumKaetzchenWorkers = 3
                SchedulerExternalMemoryQueue = false
                SchedulerQueueSize = 0
                SchedulerMaxBurst = 16
                UnwrapDelay = 250
                GatewayDelay = 500
                ServiceDelay = 500
                KaetzchenDelay = 750
                SchedulerSlack = 150
                SendSlack = 50
                DecoySlack = 15000
                ConnectTimeout = 60000
                HandshakeTimeout = 30000
                ReauthInterval = 30000
                SendDecoyTraffic = false
                DisableRateLimit = false
                GenerateOnly = false</code></pre>
<ul>
<li><p><strong>NumSphinxWorkers</strong></p>
<p>Specifies the number of worker instances to use for inbound Sphinx
packet processing.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>NumProviderWorkers</strong></p>
<p>Specifies the number of worker instances to use for provider specific
packet processing.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>NumKaetzchenWorkers</strong></p>
<p>Specifies the number of worker instances to use for
Kaetzchen-specific packet processing.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>SchedulerExternalMemoryQueue</strong></p>
<p>If <strong>true&gt;</strong>, the experimental disk-backed external
memory queue is enabled.</p>
<p>Type: bool</p>
<p>Required: No</p></li>
<li><p><strong>SchedulerQueueSize</strong></p>
<p>Specifies the maximum scheduler queue size before random entries will
start getting dropped. A value less than or equal to zero is treated as
unlimited.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>SchedulerMaxBurst</strong></p>
<p>Specifies the maximum number of packets that will be dispatched per
scheduler wakeup event.</p>
<p>Type:</p>
<p>Required: No</p></li>
<li><p><strong>UnwrapDelay</strong></p>
<p>Specifies the maximum unwrap delay due to queueing in
milliseconds.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>GatewayDelay</strong></p>
<p>Specifies the maximum gateway node worker delay due to queueing in
milliseconds.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>ServiceDelay</strong></p>
<p>Specifies the maximum provider delay due to queueing in
milliseconds.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>KaetzchenDelay</strong></p>
<p>Specifies the maximum kaetzchen delay due to queueing in
milliseconds.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>SchedulerSlack</strong></p>
<p>Specifies the maximum scheduler slack due to queueing and/or
processing in milliseconds.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>SendSlack</strong></p>
<p>Specifies the maximum send-queue slack due to queueing and/or
congestion in milliseconds.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>DecoySlack</strong></p>
<p>Specifies the maximum decoy sweep slack due to external delays such
as latency before a loop decoy packet will be considered lost.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>ConnectTimeout</strong></p>
<p>Specifies the maximum time a connection can take to establish a
TCP/IP connection in milliseconds.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>HandshakeTimeout</strong></p>
<p>Specifies the maximum time a connection can take for a link-protocol
handshake in milliseconds.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>ReauthInterval</strong></p>
<p>Specifies the interval at which a connection will be reauthenticated
in milliseconds.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>SendDecoyTraffic</strong></p>
<p>If <strong>true&gt;</strong>, decoy traffic is enabled. This
parameter is experimental and untuned, and is disabled by default.</p>
<div class="note">
<p>This option will be removed once decoy traffic is fully
implemented.</p>
</div>
<p>Type: bool</p>
<p>Required: No</p></li>
<li><p><strong>DisableRateLimit</strong></p>
<p>If <strong>true&gt;</strong>, the per-client rate limiter is
disabled.</p>
<div class="note">
<p>This option should only be used for testing.</p>
</div>
<p>Type: bool</p>
<p>Required: No</p></li>
<li><p><strong>GenerateOnly</strong></p>
<p>If <strong>true</strong>, the server immediately halts and cleans up
after long-term key generation.</p>
<p>Type: bool</p>
<p>Required: No</p></li>
</ul>
</div>
<h3 id="gateway-config">Configuring gateway nodes</h3>
<p>The following configuration is drawn from the reference
implementation in
<code>katzenpost/docker/dirauth_mixnet/gateway1/katzenpost.toml</code>.
In a real-world mixnet, the component hosts would not be sharing a
single IP address. For more information about the test mixnet, see
<strong><a href="#container">Using the Katzenpost Docker test
network</a></strong>.</p>
<table>
<caption>Gateway node configuration sections</caption>
<colgroup>
<col style="width: 100%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p><a href="#gateway-server-section-config">Gateway node: Server
section</a></p></td>
</tr>
<tr class="even">
<td><p><a href="#gateway-logging-config">Gateway node: Logging
section</a></p></td>
</tr>
<tr class="odd">
<td><p><a href="#gateway-gateway-section-config">Gateway node: Gateway
section</a></p></td>
</tr>
<tr class="even">
<td><p><a href="#gateway-pki-config">Gateway node: PKI
section</a></p></td>
</tr>
<tr class="odd">
<td><p><a href="#gateway-management-config">Gateway node: Management
section</a></p></td>
</tr>
<tr class="even">
<td><p><a href="#gateway-sphinx-config">Gateway node: SphinxGeometry
section</a></p></td>
</tr>
<tr class="odd">
<td><p><a href="#gateway-debug-config">Gateway node: Debug
section</a></p></td>
</tr>
</tbody>
</table>
<h4 id="gateway-server-section-config">Gateway node: Server section</h4>
<p>The <code>Server</code> section configures mandatory basic parameters
for each server node.</p>
<pre><code>[Server]
    Identifier = &quot;gateway1&quot;
    WireKEM = &quot;xwing&quot;
    PKISignatureScheme = &quot;Ed25519&quot;
    Addresses = [&quot;127.0.0.1:30004&quot;]
    OnlyAdvertiseAltAddresses = false
    MetricsAddress = &quot;127.0.0.1:30005&quot;
    DataDir = &quot;/dirauth_mixnet/gateway1&quot;
    IsGatewayNode = true
    IsServiceNode = false
    [Server.AltAddresses]
        TCP = [&quot;localhost:30004&quot;]</code></pre>
<h5 class="unnumbered"></h5>
<div class="informalexample">
<ul>
<li><p><strong>Identifier</strong></p>
<p>Specifies the human-readable identifier for a node, and must be
unique per mixnet. The identifier can be an FQDN but does not have to
be.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>WireKEM</strong></p>
<p>WireKEM specifies the key encapsulation mechanism (KEM) scheme for
the <a href="https://eprint.iacr.org/2022/539">PQ Noise</a>-based wire
protocol (link layer) that nodes use to communicate with each other. PQ
Noise is a post-quantum variation of the <a
href="https://noiseprotocol.org/">Noise protocol framework</a>, which
algebraically transforms ECDH handshake patterns into KEM
encapsulate/decapsulate operations.</p>
<p>This configuration option supports the optional use of hybrid
post-quantum cryptography to strengthen security. The following KEM
schemes are supported:</p>
<ul>
<li><p><strong>Classical:</strong> "x25519", "x448"</p>
<div class="note">
<p>X25519 and X448 are actually non-interactive key-exchanges (NIKEs),
not KEMs. Katzenpost uses a Hashed ElGamal cryptographic construction to
convert them from NIKEs to KEMs.</p>
</div></li>
<li><p><strong>Hybrid post-quantum:</strong> "mlkem768",
"sntrup4591761", "frodo640shake", "mceliece348864", "mceliece348864f",
"mceliece460896", "mceliece460896f", "mceliece6688128",
"mceliece6688128f", "mceliece6960119", "mceliece6960119f",
"mceliece8192128", "mceliece8192128f", "xwing", "Kyber768-X25519",
"MLKEM768-X25519", "MLKEM768-X448", "CTIDH511", "CTIDH512", "CTIDH1024",
"CTIDH2048", "CTIDH512-X25519", "CTIDH512-X25519"</p></li>
</ul>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>PKISignatureScheme</strong></p>
<p>Specifies the cryptographic signature scheme that will be used by all
components of the mix network when interacting with the PKI system. Mix
nodes sign their descriptors using this signature scheme, and dirauth
nodes similarly sign PKI documents using the same scheme.</p>
<p>The following signature schemes are supported:</p>
<ul>
<li><p><strong>Classical:</strong> "ed25519", "ed448"</p></li>
<li><p><strong>Hybrid post-quantum:</strong> "Ed25519 Sphincs+",
"Ed448-Sphincs+", "Ed25519-Dilithium2", "Ed448-Dilithium3"</p></li>
</ul>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>Addresses</strong></p>
<p>Specifies a list of one or more address URLs in a format that
contains the transport protocol, IP address, and port number that the
server will bind to for incoming connections. Katzenpost supports URLs
with that start with either "tcp://" or "quic://" such as:
["tcp://192.168.1.1:30001"] and ["quic://192.168.1.1:40001"].</p>
<p>Type: []string</p>
<p>Required: Yes</p></li>
<li><p><strong>BindAddresses</strong></p>
<p>If <strong>true</strong>, allows setting of listener addresses that
the server will bind to and accept connections on. These addresses are
not advertised in the PKI.</p>
<p>Type: bool</p>
<p>Required: No</p></li>
<li><p><strong>MetricsAddress</strong></p>
<p>Specifies the address/port to bind the Prometheus metrics endpoint
to.</p>
<p>Type: string</p>
<p>Required: No</p></li>
<li><p><strong>DataDir</strong></p>
<p>Specifies the absolute path to a node's state directory. This is
where persistence.db is written to disk and where a node stores its
cryptographic key materials when started with the "-g" commmand-line
option.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>IsGatewayNode</strong></p>
<p>If <strong>true&gt;</strong>, the server is a gateway node.</p>
<p>Type: bool</p>
<p>Required: No</p></li>
<li><p><strong>IsServiceNode</strong></p>
<p>If <strong>true&gt;</strong>, the server is a service node.</p>
<p>Type: bool</p>
<p>Required: No</p></li>
</ul>
</div>
<h4 id="gateway-logging-config">Gateway node: Logging section</h4>
<h5 class="unnumbered"></h5>
<div class="informalexample">
<p>The <code>Logging</code> configuration section controls logging
behavior across Katzenpost.</p>
<pre><code>[Logging]
                Disable = false
                File = &quot;katzenpost.log&quot;
                Level = &quot;INFO&quot;</code></pre>
<ul>
<li><p><strong>Disable</strong></p>
<p>If <strong>true&gt;</strong>, logging is disabled.</p>
<p>Type: bool</p>
<p>Required: No</p></li>
<li><p><strong>File</strong></p>
<p>Specifies the log file. If omitted, <code>stdout</code> is used.</p>
<p>An absolute or relative file path can be specified. A relative path
is relative to the DataDir specified in the <code>Server</code> section
of the configuration.</p>
<p>Type: string</p>
<p>Required: No</p></li>
<li><p><strong>Level</strong></p>
<p>Supported logging level values are ERROR | WARNING | NOTICE |INFO |
DEBUG.</p>
<p>Type: string</p>
<p>Required: No</p>
<div class="warning">
<p>The DEBUG log level is unsafe for production use.</p>
</div></li>
</ul>
</div>
<h4 id="gateway-gateway-section-config">Gateway node: Gateway
section</h4>
<p>The <code>Gateway</code> section of the configuration is required for
configuring a Gateway node. The section must contain
<code>UserDB</code>and <code>SpoolDB</code> definitions. <a
href="https://github.com/boltdb/bolt">Bolt</a> is an embedded database
library for the Go programming language that Katzenpost has used in the
past for its user and spool databases. Because Katzenpost currently
persists data on Service nodes instead of Gateways, these databases will
probably be deprecated in favour of in-memory concurrency structures. In
the meantime, it remains necessary to configure a Gateway node as shown
below, only changing the file paths as needed:</p>
<pre><code>[Gateway]
    [Gateway.UserDB]
        Backend = &quot;bolt&quot;
            [Gateway.UserDB.Bolt]
                UserDB = &quot;/dirauth_mixnet/gateway1/users.db&quot;
    [Gateway.SpoolDB]
        Backend = &quot;bolt&quot;
            [Gateway.SpoolDB.Bolt]
                SpoolDB = &quot;/dirauth_mixnet/gateway1/spool.db&quot;</code></pre>
<h4 id="gateway-pki-config">Gateway node: PKI section</h4>
<h5 class="unnumbered"></h5>
<div class="informalexample">
<p>The <code>PKI</code> section contains the directory authority
configuration for a mix, gateway, or service node.</p>
<pre><code>[PKI]
[PKI.dirauth]

    [[PKI.dirauth.Authorities]]
        Identifier = &quot;auth1&quot;
        IdentityPublicKey = &quot;&quot;&quot;-----BEGIN ED25519 PUBLIC KEY-----
tqN6tpOVotHWXKCszVn2kS7vAZjQpvJjQF3Qz/Qwhyg=
-----END ED25519 PUBLIC KEY-----
&quot;&quot;&quot;
        PKISignatureScheme = &quot;Ed25519&quot;
        LinkPublicKey = &quot;&quot;&quot;-----BEGIN XWING PUBLIC KEY-----
JnJ8ztQEIjAkKJcpuZvJAdkWjBim/5G5d8yoosEQHeGJeeBqNPdm2AitUbpiQPcd
tNCo9DxuC9Ieqmsfw0YpV6AtOOsaInA6QnHDYcuBfZcQL5MU4+t2TzpBZQYlrSED
hPCKrAG+8GEUl6akseG371WQzEtPpEWWCJCJOiS/VDFZT7eKrldlumN6gfiB84sR
...
arFh/WKwYJUj+aGBsFYSqGdzC6MdY4x/YyFe2ze0MJEjThQE91y1d/LCQ3Sb7Ri+
u6PBi3JU2qzlPEejDKwK0t5tMNEAkq8iNrpRTdD/hS0gR+ZIN8Z9QKh7Xf94FWG2
H+r8OaqImQhgHabrWRDyLg==
-----END XWING PUBLIC KEY-----
&quot;&quot;&quot;
        WireKEMScheme = &quot;xwing&quot;
        Addresses = [&quot;127.0.0.1:30001&quot;]

    [[PKI.dirauth.Authorities]]
        Identifier = &quot;auth2&quot;
        IdentityPublicKey = &quot;&quot;&quot;-----BEGIN ED25519 PUBLIC KEY-----
O51Ty2WLu4C1ETMa29s03bMXV72gnjJfTfwLV++LVBI=
-----END ED25519 PUBLIC KEY-----    
&quot;&quot;&quot;
        PKISignatureScheme = &quot;Ed25519&quot;
        LinkPublicKey = &quot;&quot;&quot;-----BEGIN XWING PUBLIC KEY-----
TtQkg2XKUnY602FFBaPJ+zpN0Twy20cwyyFxh7FNUjaXA9MAJXs0vUwFbJc6BjYv
f+olKnlIKFSmDvcF74U6w1F0ObugwTNKNxeYKPKhX4FiencUbRwkHoYHdtZdSctz
TKy08qKQyCAccqCRpdo6ZtYXPAU+2rthjYTOL7Zn+7SHUKCuJClcPnvEYjVcJxtZ
...
ubJIe5U4nMJbBkOqr7Kq6niaEkiLODa0tkpB8tKMYTMBdcYyHSXCzpo7U9sb6LAR
HktiTBDtRXviu2vbw7VRXhkMW2kjYZDtReQ5sAse04DvmD49zgTp1YxYW+wWFaL3
37X7/SNuLdHX4PHZXIWHBQ==
-----END XWING PUBLIC KEY-----  
&quot;&quot;&quot;
        WireKEMScheme = &quot;xwing&quot;
        Addresses = [&quot;127.0.0.1:30002&quot;]

    [[PKI.dirauth.Authorities]]
        Identifier = &quot;auth3&quot;
        IdentityPublicKey = &quot;&quot;&quot;-----BEGIN ED25519 PUBLIC KEY-----
zQvydRYJq3npeLcg1NqIf+SswEKE5wFmiwNsI9Z1whQ=
-----END ED25519 PUBLIC KEY-----
&quot;&quot;&quot;
        PKISignatureScheme = &quot;Ed25519&quot;
        LinkPublicKey = &quot;&quot;&quot;
-----BEGIN XWING PUBLIC KEY-----
OYK9FiC53xwZ1VST3jDOO4tR+cUMSVRSekmigZMChSjDCPZbKut8TblxtlUfc/yi
Ugorz4NIvYPMWUt3QPwS2UWq8/HMWXNGPUiAevg12+oV+jOJXaJeCfY24UekJnSw
TNcdGaFZFSR0FocFcPBBnrK1M2B8w8eEUKQIsXRDM3x/8aRIuDif+ve8rSwpgKeh
...
OdVD3yw7OOS8uPZLORGQFyJbHtVmFPVvwja4G/o2gntAoHUZ2LiJJakpVhhlSyrI
yuzvwwFtZVfWtNb5gAKZCyg0aduR3qgd7MPerRF+YopZk3OCRpC02YxfUZrHv398
FZWJFK0R8iU52CEUxVpXTA==
-----END XWING PUBLIC KEY-----  
&quot;&quot;&quot;
        WireKEMScheme = &quot;xwing&quot;
        Addresses = [&quot;127.0.0.1:30003&quot;]</code></pre>
<ul>
<li><p><strong>Identifier</strong></p>
<p>Specifies the human-readable identifier for a node, which must be
unique per mixnet. The identifier can be an FQDN but does not have to
be.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>IdentityPublicKey</strong></p>
<p>String containing the node's public identity key in PEM format.
<code>IdentityPublicKey</code> is the node's permanent identifier and is
used to verify cryptographic signatures produced by its private identity
key.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>PKISignatureScheme</strong></p>
<p>Specifies the cryptographic signature scheme that will be used by all
components of the mix network when interacting with the PKI system. Mix
nodes sign their descriptors using this signature scheme, and dirauth
nodes similarly sign PKI documents using the same scheme.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>LinkPublicKey</strong></p>
<p>String containing the peer's public link-layer key in PEM format.
<code>LinkPublicKey</code> must match the specified
<code>WireKEMScheme</code>.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>WireKEMScheme</strong></p>
<p>The name of the wire protocol key-encapsulation mechanism (KEM) to
use.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>Addresses</strong></p>
<p>Specifies a list of one or more address URLs in a format that
contains the transport protocol, IP address, and port number that the
server will bind to for incoming connections. Katzenpost supports URLs
that start with either "tcp://" or "quic://" such as:
["tcp://192.168.1.1:30001"] and ["quic://192.168.1.1:40001"].</p>
<p>Type: []string</p>
<p>Required: Yes</p></li>
</ul>
</div>
<h4 id="gateway-management-config">Gateway node: Management section</h4>
<h5 class="unnumbered"></h5>
<div class="informalexample">
<p>The <code>Management</code> section specifies connectivity
information for the Katzenpost control protocol which can be used to
make run-time configuration changes. A configuration resembles the
following:</p>
<pre><code>[Management]
   Enable = false
   Path = &quot;/dirauth_mixnet/mix1/management_sock&quot;</code></pre>
<ul>
<li><p><strong>Enable</strong></p>
<p>If <strong>true&gt;</strong>, the management interface is
enabled.</p>
<p>Type: bool</p>
<p>Required: No</p></li>
<li><p><strong>Path</strong></p>
<p>Specifies the path to the management interface socket. If left empty,
then <code>management_sock</code> is located in the configuration's
defined <code>DataDir</code>&gt;.</p>
<p>Type: string</p>
<p>Required: No</p></li>
</ul>
</div>
<h4 id="gateway-sphinx-config">Gateway node: SphinxGeometry section</h4>
<h5 class="unnumbered"></h5>
<div class="informalexample">
<p>The <code>SphinxGeometry</code> section defines parameters for the
Sphinx encrypted nested-packet format used internally by Katzenpost.</p>
<div class="warning">
<p>The values in the <code>SphinxGeometry</code> configuration section
must be programmatically generated by <code>gensphinx</code>. Many of
the parameters are interdependent and cannot be individually modified.
Do not modify the these values by hand.</p>
</div>
<p>The settings in this section are generated by the
<code>gensphinx</code> utility, which computes the Sphinx geometry based
on the following user-supplied directives:</p>
<ul>
<li><p>The number of mix node layers (not counting gateway and service
nodes)</p></li>
<li><p>The length of the application-usable packet payload</p></li>
<li><p>The selected NIKE or KEM scheme</p></li>
</ul>
<p>The output in TOML should then be pasted unchanged into the node's
configuration file, as shown below. For more information, see <a
href="#gensphinx">Appendix: Using </a>.</p>
<pre><code>[SphinxGeometry]
                PacketLength = 3082
                NrHops = 5
                HeaderLength = 476
                RoutingInfoLength = 410
                PerHopRoutingInfoLength = 82
                SURBLength = 572
                SphinxPlaintextHeaderLength = 2
                PayloadTagLength = 32
                ForwardPayloadLength = 2574
                UserForwardPayloadLength = 2000
                NextNodeHopLength = 65
                SPRPKeyMaterialLength = 64
                NIKEName = &quot;x25519&quot;
                KEMName = &quot;&quot;</code></pre>
<ul>
<li><p><strong>PacketLength</strong></p>
<p>The length of a Sphinx packet in bytes.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>NrHops</strong></p>
<p>The number of hops a Sphinx packet takes through the mixnet. Because
packet headers hold destination information for each hop, the size of
the header increases linearly with the number of hops.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>HeaderLength</strong></p>
<p>The total length of the Sphinx packet header in bytes.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>RoutingInfoLength</strong></p>
<p>The total length of the routing information portion of the Sphinx
packet header.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>PerHopRoutingInfoLength</strong></p>
<p>The length of the per-hop routing information in the Sphinx packet
header.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>SURBLength</strong></p>
<p>The length of a single-use reply block (SURB).</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>SphinxPlaintextHeaderLength</strong></p>
<p>The length of the plaintext Sphinx packet header.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>PayloadTagLength</strong></p>
<p>The length of the payload tag.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>ForwardPayloadLength</strong></p>
<p>The total size of the payload.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>UserForwardPayloadLength</strong></p>
<p>The size of the usable payload.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>NextNodeHopLength</strong></p>
<p>The <code>NextNodeHopLength</code> is derived from the largest
routing-information block that we expect to encounter. Other packets
have <code>NextNodeHop</code> + <code>NodeDelay</code> sections, or a
<code>Recipient</code> section, both of which are shorter.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>SPRPKeyMaterialLength</strong></p>
<p>The length of the strong pseudo-random permutation (SPRP) key.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>NIKEName</strong></p>
<p>The name of the non-interactive key exchange (NIKE) scheme used by
Sphinx packets.</p>
<p><code>NIKEName</code> and <code>KEMName</code> are mutually
exclusive.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>KEMName</strong></p>
<p>The name of the key encapsulation mechanism (KEM) used by Sphinx
packets.</p>
<p><code>NIKEName</code> and <code>KEMName</code> are mutually
exclusive.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
</ul>
</div>
<h4 id="gateway-debug-config">Gateway node: Debug section</h4>
<h5 class="unnumbered"></h5>
<div class="informalexample">
<p>The <code>Debug</code> section is the Katzenpost server debug
configuration for advanced tuning.</p>
<pre><code>[Debug]
                NumSphinxWorkers = 16
                NumServiceWorkers = 3
                NumGatewayWorkers = 3
                NumKaetzchenWorkers = 3
                SchedulerExternalMemoryQueue = false
                SchedulerQueueSize = 0
                SchedulerMaxBurst = 16
                UnwrapDelay = 250
                GatewayDelay = 500
                ServiceDelay = 500
                KaetzchenDelay = 750
                SchedulerSlack = 150
                SendSlack = 50
                DecoySlack = 15000
                ConnectTimeout = 60000
                HandshakeTimeout = 30000
                ReauthInterval = 30000
                SendDecoyTraffic = false
                DisableRateLimit = false
                GenerateOnly = false</code></pre>
<ul>
<li><p><strong>NumSphinxWorkers</strong></p>
<p>Specifies the number of worker instances to use for inbound Sphinx
packet processing.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>NumProviderWorkers</strong></p>
<p>Specifies the number of worker instances to use for provider specific
packet processing.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>NumKaetzchenWorkers</strong></p>
<p>Specifies the number of worker instances to use for
Kaetzchen-specific packet processing.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>SchedulerExternalMemoryQueue</strong></p>
<p>If <strong>true&gt;</strong>, the experimental disk-backed external
memory queue is enabled.</p>
<p>Type: bool</p>
<p>Required: No</p></li>
<li><p><strong>SchedulerQueueSize</strong></p>
<p>Specifies the maximum scheduler queue size before random entries will
start getting dropped. A value less than or equal to zero is treated as
unlimited.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>SchedulerMaxBurst</strong></p>
<p>Specifies the maximum number of packets that will be dispatched per
scheduler wakeup event.</p>
<p>Type:</p>
<p>Required: No</p></li>
<li><p><strong>UnwrapDelay</strong></p>
<p>Specifies the maximum unwrap delay due to queueing in
milliseconds.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>GatewayDelay</strong></p>
<p>Specifies the maximum gateway node worker delay due to queueing in
milliseconds.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>ServiceDelay</strong></p>
<p>Specifies the maximum provider delay due to queueing in
milliseconds.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>KaetzchenDelay</strong></p>
<p>Specifies the maximum kaetzchen delay due to queueing in
milliseconds.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>SchedulerSlack</strong></p>
<p>Specifies the maximum scheduler slack due to queueing and/or
processing in milliseconds.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>SendSlack</strong></p>
<p>Specifies the maximum send-queue slack due to queueing and/or
congestion in milliseconds.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>DecoySlack</strong></p>
<p>Specifies the maximum decoy sweep slack due to external delays such
as latency before a loop decoy packet will be considered lost.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>ConnectTimeout</strong></p>
<p>Specifies the maximum time a connection can take to establish a
TCP/IP connection in milliseconds.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>HandshakeTimeout</strong></p>
<p>Specifies the maximum time a connection can take for a link-protocol
handshake in milliseconds.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>ReauthInterval</strong></p>
<p>Specifies the interval at which a connection will be reauthenticated
in milliseconds.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>SendDecoyTraffic</strong></p>
<p>If <strong>true&gt;</strong>, decoy traffic is enabled. This
parameter is experimental and untuned, and is disabled by default.</p>
<div class="note">
<p>This option will be removed once decoy traffic is fully
implemented.</p>
</div>
<p>Type: bool</p>
<p>Required: No</p></li>
<li><p><strong>DisableRateLimit</strong></p>
<p>If <strong>true&gt;</strong>, the per-client rate limiter is
disabled.</p>
<div class="note">
<p>This option should only be used for testing.</p>
</div>
<p>Type: bool</p>
<p>Required: No</p></li>
<li><p><strong>GenerateOnly</strong></p>
<p>If <strong>true</strong>, the server immediately halts and cleans up
after long-term key generation.</p>
<p>Type: bool</p>
<p>Required: No</p></li>
</ul>
</div>
<h3 id="service-config">Configuring service nodes</h3>
<p>The following configuration is drawn from the reference
implementation in
<code>katzenpost/docker/dirauth_mixnet/servicenode1/authority.toml</code>.
In a real-world mixnet, the component hosts would not be sharing a
single IP address. For more information about the test mixnet, see
<strong><a href="#container">Using the Katzenpost Docker test
network</a></strong>.</p>
<table>
<caption>Mix node configuration sections</caption>
<colgroup>
<col style="width: 100%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p><a href="#service-server-section-config">Service node: Server
section</a></p></td>
</tr>
<tr class="even">
<td><p><a href="#service-logging-config">Service node: Logging
section</a></p></td>
</tr>
<tr class="odd">
<td><p><a href="#service-servicenode-section-config">Service node:
ServiceNode section</a></p></td>
</tr>
<tr class="even">
<td><p><a href="#service-pki-config">Service node: PKI
section</a></p></td>
</tr>
<tr class="odd">
<td><p><a href="#service-management-config">Service node: Management
section</a></p></td>
</tr>
<tr class="even">
<td><p><a href="#service-sphinx-config">Service node: SphinxGeometry
section</a></p></td>
</tr>
<tr class="odd">
<td><p><a href="#service-debug-config">Service node: Debug
section</a></p></td>
</tr>
</tbody>
</table>
<h4 id="service-server-section-config">Service node: Server section</h4>
<p>The <code>Server</code> section configures mandatory basic parameters
for each server node.</p>
<pre><code>[Server]
    Identifier = &quot;servicenode1&quot;
    WireKEM = &quot;xwing&quot;
    PKISignatureScheme = &quot;Ed25519&quot;
    Addresses = [&quot;127.0.0.1:30006&quot;]
    OnlyAdvertiseAltAddresses = false
    MetricsAddress = &quot;127.0.0.1:30007&quot;
    DataDir = &quot;/dirauth_mixnet/servicenode1&quot;
    IsGatewayNode = false
    IsServiceNode = true
    [Server.AltAddresses]</code></pre>
<h5 class="unnumbered"></h5>
<div class="informalexample">
<ul>
<li><p><strong>Identifier</strong></p>
<p>Specifies the human-readable identifier for a node, and must be
unique per mixnet. The identifier can be an FQDN but does not have to
be.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>WireKEM</strong></p>
<p>WireKEM specifies the key encapsulation mechanism (KEM) scheme for
the <a href="https://eprint.iacr.org/2022/539">PQ Noise</a>-based wire
protocol (link layer) that nodes use to communicate with each other. PQ
Noise is a post-quantum variation of the <a
href="https://noiseprotocol.org/">Noise protocol framework</a>, which
algebraically transforms ECDH handshake patterns into KEM
encapsulate/decapsulate operations.</p>
<p>This configuration option supports the optional use of hybrid
post-quantum cryptography to strengthen security. The following KEM
schemes are supported:</p>
<ul>
<li><p><strong>Classical:</strong> "x25519", "x448"</p>
<div class="note">
<p>X25519 and X448 are actually non-interactive key-exchanges (NIKEs),
not KEMs. Katzenpost uses a Hashed ElGamal cryptographic construction to
convert them from NIKEs to KEMs.</p>
</div></li>
<li><p><strong>Hybrid post-quantum:</strong> "mlkem768",
"sntrup4591761", "frodo640shake", "mceliece348864", "mceliece348864f",
"mceliece460896", "mceliece460896f", "mceliece6688128",
"mceliece6688128f", "mceliece6960119", "mceliece6960119f",
"mceliece8192128", "mceliece8192128f", "xwing", "Kyber768-X25519",
"MLKEM768-X25519", "MLKEM768-X448", "CTIDH511", "CTIDH512", "CTIDH1024",
"CTIDH2048", "CTIDH512-X25519", "CTIDH512-X25519"</p></li>
</ul>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>PKISignatureScheme</strong></p>
<p>Specifies the cryptographic signature scheme that will be used by all
components of the mix network when interacting with the PKI system. Mix
nodes sign their descriptors using this signature scheme, and dirauth
nodes similarly sign PKI documents using the same scheme.</p>
<p>The following signature schemes are supported:</p>
<ul>
<li><p><strong>Classical:</strong> "ed25519", "ed448"</p></li>
<li><p><strong>Hybrid post-quantum:</strong> "Ed25519 Sphincs+",
"Ed448-Sphincs+", "Ed25519-Dilithium2", "Ed448-Dilithium3"</p></li>
</ul>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>Addresses</strong></p>
<p>Specifies a list of one or more address URLs in a format that
contains the transport protocol, IP address, and port number that the
server will bind to for incoming connections. Katzenpost supports URLs
with that start with either "tcp://" or "quic://" such as:
["tcp://192.168.1.1:30001"] and ["quic://192.168.1.1:40001"].</p>
<p>Type: []string</p>
<p>Required: Yes</p></li>
<li><p><strong>BindAddresses</strong></p>
<p>If <strong>true</strong>, allows setting of listener addresses that
the server will bind to and accept connections on. These addresses are
not advertised in the PKI.</p>
<p>Type: bool</p>
<p>Required: No</p></li>
<li><p><strong>MetricsAddress</strong></p>
<p>Specifies the address/port to bind the Prometheus metrics endpoint
to.</p>
<p>Type: string</p>
<p>Required: No</p></li>
<li><p><strong>DataDir</strong></p>
<p>Specifies the absolute path to a node's state directory. This is
where persistence.db is written to disk and where a node stores its
cryptographic key materials when started with the "-g" commmand-line
option.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>IsGatewayNode</strong></p>
<p>If <strong>true&gt;</strong>, the server is a gateway node.</p>
<p>Type: bool</p>
<p>Required: No</p></li>
<li><p><strong>IsServiceNode</strong></p>
<p>If <strong>true&gt;</strong>, the server is a service node.</p>
<p>Type: bool</p>
<p>Required: No</p></li>
</ul>
</div>
<h4 id="service-logging-config">Service node: Logging section</h4>
<h5 class="unnumbered"></h5>
<div class="informalexample">
<p>The <code>Logging</code> configuration section controls logging
behavior across Katzenpost.</p>
<pre><code>[Logging]
                Disable = false
                File = &quot;katzenpost.log&quot;
                Level = &quot;INFO&quot;</code></pre>
<ul>
<li><p><strong>Disable</strong></p>
<p>If <strong>true&gt;</strong>, logging is disabled.</p>
<p>Type: bool</p>
<p>Required: No</p></li>
<li><p><strong>File</strong></p>
<p>Specifies the log file. If omitted, <code>stdout</code> is used.</p>
<p>An absolute or relative file path can be specified. A relative path
is relative to the DataDir specified in the <code>Server</code> section
of the configuration.</p>
<p>Type: string</p>
<p>Required: No</p></li>
<li><p><strong>Level</strong></p>
<p>Supported logging level values are ERROR | WARNING | NOTICE |INFO |
DEBUG.</p>
<p>Type: string</p>
<p>Required: No</p>
<div class="warning">
<p>The DEBUG log level is unsafe for production use.</p>
</div></li>
</ul>
</div>
<h4 id="service-servicenode-section-config">Service node: ServiceNode
section</h4>
<p>The <code>ServiceNode</code> section contains configurations for each
network service that Katzenpost supports.</p>
<p>Services, termed <a
href="https://github.com/katzenpost/katzenpost/blob/main/docs/Specificatons/pdf/kaetzchen.pdf">Kaetzchen</a>,
can be divided into built-in and external services. External services
are provided through the <a
href="https://pkg.go.dev/github.com/katzenpost/katzenpost@v0.0.35/server/cborplugin#ResponseFactory">CBORPlugin</a>,
a Go programming language implementation of the <a
href="https://datatracker.ietf.org/doc/html/rfc8949">Concise Binary
Object Representation (CBOR)</a>, a binary data serialization format.
While native services need simply to be activated, external services are
invoked by a separate command and connected to the mixnet over a Unix
socket. The plugin allows mixnet services to be added in any programming
language.</p>
<pre><code>[ServiceNode]
                    
    [[ServiceNode.Kaetzchen]]
        Capability = &quot;echo&quot;
        Endpoint = &quot;+echo&quot;
        Disable = false
    
    [[ServiceNode.CBORPluginKaetzchen]]
        Capability = &quot;spool&quot;
        Endpoint = &quot;+spool&quot;
        Command = &quot;/dirauth_mixnet/memspool.alpine&quot;
        MaxConcurrency = 1
        Disable = false
        [ServiceNode.CBORPluginKaetzchen.Config]
            data_store = &quot;/dirauth_mixnet/servicenode1/memspool.storage&quot;
            log_dir = &quot;/dirauth_mixnet/servicenode1&quot;
    
    [[ServiceNode.CBORPluginKaetzchen]]
        Capability = &quot;pigeonhole&quot;
        Endpoint = &quot;+pigeonhole&quot;
        Command = &quot;/dirauth_mixnet/pigeonhole.alpine&quot;
        MaxConcurrency = 1
        Disable = false
        [ServiceNode.CBORPluginKaetzchen.Config]
            db = &quot;/dirauth_mixnet/servicenode1/map.storage&quot;
            log_dir = &quot;/dirauth_mixnet/servicenode1&quot;
    
    [[ServiceNode.CBORPluginKaetzchen]]
        Capability = &quot;panda&quot;
        Endpoint = &quot;+panda&quot;
        Command = &quot;/dirauth_mixnet/panda_server.alpine&quot;
        MaxConcurrency = 1
        Disable = false
        [ServiceNode.CBORPluginKaetzchen.Config]
            fileStore = &quot;/dirauth_mixnet/servicenode1/panda.storage&quot;
            log_dir = &quot;/dirauth_mixnet/servicenode1&quot;
            log_level = &quot;INFO&quot;
    
    [[ServiceNode.CBORPluginKaetzchen]]
        Capability = &quot;http&quot;
        Endpoint = &quot;+http&quot;
        Command = &quot;/dirauth_mixnet/proxy_server.alpine&quot;
        MaxConcurrency = 1
        Disable = false
        [ServiceNode.CBORPluginKaetzchen.Config]
            host = &quot;localhost:4242&quot;
            log_dir = &quot;/dirauth_mixnet/servicenode1&quot;
            log_level = &quot;DEBUG&quot;</code></pre>
<p><strong>Common parameters:</strong></p>
<ul>
<li><p><strong>Capability</strong></p>
<p>Specifies the protocol capability exposed by the agent.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>Endpoint</strong></p>
<p>Specifies the provider-side Endpoint where the agent will accept
requests. While not required by the specification, this server only
supports Endpoints that are lower-case local parts of an email
address.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>Command</strong></p>
<p>Specifies the full path to the external plugin program that
implements this <code>Kaetzchen</code> service.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>MaxConcurrency</strong></p>
<p>Specifies the number of worker goroutines to start for this
service.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>Config</strong></p>
<p>Specifies extra per-agent arguments to be passed to the agent's
initialization routine.</p>
<p>Type: map[string]interface{}</p>
<p>Required: Yes</p></li>
<li><p><strong>Disable</strong></p>
<p>If <strong>true</strong>, disables a configured agent.</p>
<p>Type: bool</p>
<p>Required: No</p></li>
</ul>
<p><strong>Per-service parameters:</strong></p>
<ul>
<li><p><strong>echo</strong></p>
<p>The internal <code>echo</code> service must be enabled on every
service node of a production mixnet for decoy traffic to work
properly.</p></li>
<li><p><strong>spool</strong></p>
<p>The <code>spool</code> service supports the <code>catshadow</code>
storage protocol, which is required by the Katzen chat client. The
example configuration above shows spool enabled with the setting:</p>
<pre><code>Disable = false</code></pre>
<div class="note">
<p><code>Spool</code>, properly <code>memspool</code>, should not be
confused with the spool database on gateway nodes.</p>
</div>
<ul>
<li><p><strong>data_store</strong></p>
<p>Specifies the full path to the service database file.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>log_dir</strong></p>
<p>Specifies the path to the node's log directory.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
</ul></li>
<li><p><strong>pigeonhole</strong></p>
<p>The <code>pigeonhole</code> courier service supports the
Blinding-and-Capability scheme (BACAP)-based unlinkable messaging
protocols detailed in <strong>Place-holder for research paper
link</strong>. Most of our future protocols will use the
<code>pigeonhole</code> courier service.</p>
<ul>
<li><p><strong>db</strong></p>
<p>Specifies the full path to the service database file.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>log_dir</strong></p>
<p>Specifies the path to the node's log directory.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
</ul></li>
<li><p><strong>panda</strong></p>
<p>The <code>panda</code> storage and authentication service currently
does not work properly.</p>
<ul>
<li><p><strong>fileStore</strong></p>
<p>Specifies the full path to the service database file.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>log_dir</strong></p>
<p>Specifies the path to the node's log directory.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>log_level</strong></p>
<p>Supported values are ERROR | WARNING | NOTICE |INFO | DEBUG.</p>
<div class="warning">
<p>The DEBUG log level is unsafe for production use.</p>
</div>
<p>Type: string</p>
<p>Required: Yes</p>
<p>Required: Yes</p></li>
</ul></li>
<li><p><strong>http</strong></p>
<p>The <code>http</code> service is completely optional, but allows the
mixnet to be used as an HTTP proxy. This may be useful for integrating
with existing software systems.</p>
<ul>
<li><p><strong>host</strong></p>
<p>The host name and TCP port of the service.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>log_dir</strong></p>
<p>Specifies the path to the node's log directory.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>log_level</strong></p>
<p>Supported values are ERROR | WARNING | NOTICE |INFO | DEBUG.</p>
<p>Type: string</p>
<p>Required: Yes</p>
<p>Required: Yes</p>
<div class="warning">
<p>The DEBUG log level is unsafe for production use.</p>
</div>
<p>Type: string</p>
<p>Required: Yes</p></li>
</ul></li>
</ul>
<h4 id="service-pki-config">Service node: PKI section</h4>
<h5 class="unnumbered"></h5>
<div class="informalexample">
<p>The <code>PKI</code> section contains the directory authority
configuration for a mix, gateway, or service node.</p>
<pre><code>[PKI]
[PKI.dirauth]

    [[PKI.dirauth.Authorities]]
        Identifier = &quot;auth1&quot;
        IdentityPublicKey = &quot;&quot;&quot;-----BEGIN ED25519 PUBLIC KEY-----
tqN6tpOVotHWXKCszVn2kS7vAZjQpvJjQF3Qz/Qwhyg=
-----END ED25519 PUBLIC KEY-----
&quot;&quot;&quot;
        PKISignatureScheme = &quot;Ed25519&quot;
        LinkPublicKey = &quot;&quot;&quot;-----BEGIN XWING PUBLIC KEY-----
JnJ8ztQEIjAkKJcpuZvJAdkWjBim/5G5d8yoosEQHeGJeeBqNPdm2AitUbpiQPcd
tNCo9DxuC9Ieqmsfw0YpV6AtOOsaInA6QnHDYcuBfZcQL5MU4+t2TzpBZQYlrSED
hPCKrAG+8GEUl6akseG371WQzEtPpEWWCJCJOiS/VDFZT7eKrldlumN6gfiB84sR
...
arFh/WKwYJUj+aGBsFYSqGdzC6MdY4x/YyFe2ze0MJEjThQE91y1d/LCQ3Sb7Ri+
u6PBi3JU2qzlPEejDKwK0t5tMNEAkq8iNrpRTdD/hS0gR+ZIN8Z9QKh7Xf94FWG2
H+r8OaqImQhgHabrWRDyLg==
-----END XWING PUBLIC KEY-----
&quot;&quot;&quot;
        WireKEMScheme = &quot;xwing&quot;
        Addresses = [&quot;127.0.0.1:30001&quot;]

    [[PKI.dirauth.Authorities]]
        Identifier = &quot;auth2&quot;
        IdentityPublicKey = &quot;&quot;&quot;-----BEGIN ED25519 PUBLIC KEY-----
O51Ty2WLu4C1ETMa29s03bMXV72gnjJfTfwLV++LVBI=
-----END ED25519 PUBLIC KEY-----    
&quot;&quot;&quot;
        PKISignatureScheme = &quot;Ed25519&quot;
        LinkPublicKey = &quot;&quot;&quot;-----BEGIN XWING PUBLIC KEY-----
TtQkg2XKUnY602FFBaPJ+zpN0Twy20cwyyFxh7FNUjaXA9MAJXs0vUwFbJc6BjYv
f+olKnlIKFSmDvcF74U6w1F0ObugwTNKNxeYKPKhX4FiencUbRwkHoYHdtZdSctz
TKy08qKQyCAccqCRpdo6ZtYXPAU+2rthjYTOL7Zn+7SHUKCuJClcPnvEYjVcJxtZ
...
ubJIe5U4nMJbBkOqr7Kq6niaEkiLODa0tkpB8tKMYTMBdcYyHSXCzpo7U9sb6LAR
HktiTBDtRXviu2vbw7VRXhkMW2kjYZDtReQ5sAse04DvmD49zgTp1YxYW+wWFaL3
37X7/SNuLdHX4PHZXIWHBQ==
-----END XWING PUBLIC KEY-----  
&quot;&quot;&quot;
        WireKEMScheme = &quot;xwing&quot;
        Addresses = [&quot;127.0.0.1:30002&quot;]

    [[PKI.dirauth.Authorities]]
        Identifier = &quot;auth3&quot;
        IdentityPublicKey = &quot;&quot;&quot;-----BEGIN ED25519 PUBLIC KEY-----
zQvydRYJq3npeLcg1NqIf+SswEKE5wFmiwNsI9Z1whQ=
-----END ED25519 PUBLIC KEY-----
&quot;&quot;&quot;
        PKISignatureScheme = &quot;Ed25519&quot;
        LinkPublicKey = &quot;&quot;&quot;
-----BEGIN XWING PUBLIC KEY-----
OYK9FiC53xwZ1VST3jDOO4tR+cUMSVRSekmigZMChSjDCPZbKut8TblxtlUfc/yi
Ugorz4NIvYPMWUt3QPwS2UWq8/HMWXNGPUiAevg12+oV+jOJXaJeCfY24UekJnSw
TNcdGaFZFSR0FocFcPBBnrK1M2B8w8eEUKQIsXRDM3x/8aRIuDif+ve8rSwpgKeh
...
OdVD3yw7OOS8uPZLORGQFyJbHtVmFPVvwja4G/o2gntAoHUZ2LiJJakpVhhlSyrI
yuzvwwFtZVfWtNb5gAKZCyg0aduR3qgd7MPerRF+YopZk3OCRpC02YxfUZrHv398
FZWJFK0R8iU52CEUxVpXTA==
-----END XWING PUBLIC KEY-----  
&quot;&quot;&quot;
        WireKEMScheme = &quot;xwing&quot;
        Addresses = [&quot;127.0.0.1:30003&quot;]</code></pre>
<ul>
<li><p><strong>Identifier</strong></p>
<p>Specifies the human-readable identifier for a node, which must be
unique per mixnet. The identifier can be an FQDN but does not have to
be.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>IdentityPublicKey</strong></p>
<p>String containing the node's public identity key in PEM format.
<code>IdentityPublicKey</code> is the node's permanent identifier and is
used to verify cryptographic signatures produced by its private identity
key.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>PKISignatureScheme</strong></p>
<p>Specifies the cryptographic signature scheme that will be used by all
components of the mix network when interacting with the PKI system. Mix
nodes sign their descriptors using this signature scheme, and dirauth
nodes similarly sign PKI documents using the same scheme.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>LinkPublicKey</strong></p>
<p>String containing the peer's public link-layer key in PEM format.
<code>LinkPublicKey</code> must match the specified
<code>WireKEMScheme</code>.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>WireKEMScheme</strong></p>
<p>The name of the wire protocol key-encapsulation mechanism (KEM) to
use.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>Addresses</strong></p>
<p>Specifies a list of one or more address URLs in a format that
contains the transport protocol, IP address, and port number that the
server will bind to for incoming connections. Katzenpost supports URLs
that start with either "tcp://" or "quic://" such as:
["tcp://192.168.1.1:30001"] and ["quic://192.168.1.1:40001"].</p>
<p>Type: []string</p>
<p>Required: Yes</p></li>
</ul>
</div>
<h4 id="service-management-config">Service node: Management section</h4>
<h5 class="unnumbered"></h5>
<div class="informalexample">
<p>The <code>Management</code> section specifies connectivity
information for the Katzenpost control protocol which can be used to
make run-time configuration changes. A configuration resembles the
following:</p>
<pre><code>[Management]
   Enable = false
   Path = &quot;/dirauth_mixnet/mix1/management_sock&quot;</code></pre>
<ul>
<li><p><strong>Enable</strong></p>
<p>If <strong>true&gt;</strong>, the management interface is
enabled.</p>
<p>Type: bool</p>
<p>Required: No</p></li>
<li><p><strong>Path</strong></p>
<p>Specifies the path to the management interface socket. If left empty,
then <code>management_sock</code> is located in the configuration's
defined <code>DataDir</code>&gt;.</p>
<p>Type: string</p>
<p>Required: No</p></li>
</ul>
</div>
<h4 id="service-sphinx-config">Service node: SphinxGeometry section</h4>
<h5 class="unnumbered"></h5>
<div class="informalexample">
<p>The <code>SphinxGeometry</code> section defines parameters for the
Sphinx encrypted nested-packet format used internally by Katzenpost.</p>
<div class="warning">
<p>The values in the <code>SphinxGeometry</code> configuration section
must be programmatically generated by <code>gensphinx</code>. Many of
the parameters are interdependent and cannot be individually modified.
Do not modify the these values by hand.</p>
</div>
<p>The settings in this section are generated by the
<code>gensphinx</code> utility, which computes the Sphinx geometry based
on the following user-supplied directives:</p>
<ul>
<li><p>The number of mix node layers (not counting gateway and service
nodes)</p></li>
<li><p>The length of the application-usable packet payload</p></li>
<li><p>The selected NIKE or KEM scheme</p></li>
</ul>
<p>The output in TOML should then be pasted unchanged into the node's
configuration file, as shown below. For more information, see <a
href="#gensphinx">Appendix: Using </a>.</p>
<pre><code>[SphinxGeometry]
                PacketLength = 3082
                NrHops = 5
                HeaderLength = 476
                RoutingInfoLength = 410
                PerHopRoutingInfoLength = 82
                SURBLength = 572
                SphinxPlaintextHeaderLength = 2
                PayloadTagLength = 32
                ForwardPayloadLength = 2574
                UserForwardPayloadLength = 2000
                NextNodeHopLength = 65
                SPRPKeyMaterialLength = 64
                NIKEName = &quot;x25519&quot;
                KEMName = &quot;&quot;</code></pre>
<ul>
<li><p><strong>PacketLength</strong></p>
<p>The length of a Sphinx packet in bytes.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>NrHops</strong></p>
<p>The number of hops a Sphinx packet takes through the mixnet. Because
packet headers hold destination information for each hop, the size of
the header increases linearly with the number of hops.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>HeaderLength</strong></p>
<p>The total length of the Sphinx packet header in bytes.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>RoutingInfoLength</strong></p>
<p>The total length of the routing information portion of the Sphinx
packet header.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>PerHopRoutingInfoLength</strong></p>
<p>The length of the per-hop routing information in the Sphinx packet
header.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>SURBLength</strong></p>
<p>The length of a single-use reply block (SURB).</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>SphinxPlaintextHeaderLength</strong></p>
<p>The length of the plaintext Sphinx packet header.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>PayloadTagLength</strong></p>
<p>The length of the payload tag.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>ForwardPayloadLength</strong></p>
<p>The total size of the payload.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>UserForwardPayloadLength</strong></p>
<p>The size of the usable payload.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>NextNodeHopLength</strong></p>
<p>The <code>NextNodeHopLength</code> is derived from the largest
routing-information block that we expect to encounter. Other packets
have <code>NextNodeHop</code> + <code>NodeDelay</code> sections, or a
<code>Recipient</code> section, both of which are shorter.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>SPRPKeyMaterialLength</strong></p>
<p>The length of the strong pseudo-random permutation (SPRP) key.</p>
<p>Type: int</p>
<p>Required: Yes</p></li>
<li><p><strong>NIKEName</strong></p>
<p>The name of the non-interactive key exchange (NIKE) scheme used by
Sphinx packets.</p>
<p><code>NIKEName</code> and <code>KEMName</code> are mutually
exclusive.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
<li><p><strong>KEMName</strong></p>
<p>The name of the key encapsulation mechanism (KEM) used by Sphinx
packets.</p>
<p><code>NIKEName</code> and <code>KEMName</code> are mutually
exclusive.</p>
<p>Type: string</p>
<p>Required: Yes</p></li>
</ul>
</div>
<h4 id="service-debug-config">Service node: Debug section</h4>
<h5 class="unnumbered"></h5>
<div class="informalexample">
<p>The <code>Debug</code> section is the Katzenpost server debug
configuration for advanced tuning.</p>
<pre><code>[Debug]
                NumSphinxWorkers = 16
                NumServiceWorkers = 3
                NumGatewayWorkers = 3
                NumKaetzchenWorkers = 3
                SchedulerExternalMemoryQueue = false
                SchedulerQueueSize = 0
                SchedulerMaxBurst = 16
                UnwrapDelay = 250
                GatewayDelay = 500
                ServiceDelay = 500
                KaetzchenDelay = 750
                SchedulerSlack = 150
                SendSlack = 50
                DecoySlack = 15000
                ConnectTimeout = 60000
                HandshakeTimeout = 30000
                ReauthInterval = 30000
                SendDecoyTraffic = false
                DisableRateLimit = false
                GenerateOnly = false</code></pre>
<ul>
<li><p><strong>NumSphinxWorkers</strong></p>
<p>Specifies the number of worker instances to use for inbound Sphinx
packet processing.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>NumProviderWorkers</strong></p>
<p>Specifies the number of worker instances to use for provider specific
packet processing.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>NumKaetzchenWorkers</strong></p>
<p>Specifies the number of worker instances to use for
Kaetzchen-specific packet processing.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>SchedulerExternalMemoryQueue</strong></p>
<p>If <strong>true&gt;</strong>, the experimental disk-backed external
memory queue is enabled.</p>
<p>Type: bool</p>
<p>Required: No</p></li>
<li><p><strong>SchedulerQueueSize</strong></p>
<p>Specifies the maximum scheduler queue size before random entries will
start getting dropped. A value less than or equal to zero is treated as
unlimited.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>SchedulerMaxBurst</strong></p>
<p>Specifies the maximum number of packets that will be dispatched per
scheduler wakeup event.</p>
<p>Type:</p>
<p>Required: No</p></li>
<li><p><strong>UnwrapDelay</strong></p>
<p>Specifies the maximum unwrap delay due to queueing in
milliseconds.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>GatewayDelay</strong></p>
<p>Specifies the maximum gateway node worker delay due to queueing in
milliseconds.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>ServiceDelay</strong></p>
<p>Specifies the maximum provider delay due to queueing in
milliseconds.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>KaetzchenDelay</strong></p>
<p>Specifies the maximum kaetzchen delay due to queueing in
milliseconds.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>SchedulerSlack</strong></p>
<p>Specifies the maximum scheduler slack due to queueing and/or
processing in milliseconds.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>SendSlack</strong></p>
<p>Specifies the maximum send-queue slack due to queueing and/or
congestion in milliseconds.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>DecoySlack</strong></p>
<p>Specifies the maximum decoy sweep slack due to external delays such
as latency before a loop decoy packet will be considered lost.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>ConnectTimeout</strong></p>
<p>Specifies the maximum time a connection can take to establish a
TCP/IP connection in milliseconds.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>HandshakeTimeout</strong></p>
<p>Specifies the maximum time a connection can take for a link-protocol
handshake in milliseconds.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>ReauthInterval</strong></p>
<p>Specifies the interval at which a connection will be reauthenticated
in milliseconds.</p>
<p>Type: int</p>
<p>Required: No</p></li>
<li><p><strong>SendDecoyTraffic</strong></p>
<p>If <strong>true&gt;</strong>, decoy traffic is enabled. This
parameter is experimental and untuned, and is disabled by default.</p>
<div class="note">
<p>This option will be removed once decoy traffic is fully
implemented.</p>
</div>
<p>Type: bool</p>
<p>Required: No</p></li>
<li><p><strong>DisableRateLimit</strong></p>
<p>If <strong>true&gt;</strong>, the per-client rate limiter is
disabled.</p>
<div class="note">
<p>This option should only be used for testing.</p>
</div>
<p>Type: bool</p>
<p>Required: No</p></li>
<li><p><strong>GenerateOnly</strong></p>
<p>If <strong>true</strong>, the server immediately halts and cleans up
after long-term key generation.</p>
<p>Type: bool</p>
<p>Required: No</p></li>
</ul>
</div>
<h1 id="container">Using the Katzenpost Docker test network</h1>
<p>Katzenpost provides a ready-to-deploy Docker image for developers who
need a non-production test environment for developing and testing client
applications and server side plugins. By running this image on a single
computer, you avoid the need to build and manage a complex multi-node
mix net. The image can also be run using <a
href="https://podman.io/">Podman</a></p>
<p>The test mix network includes the following components:</p>
<ul>
<li><p>Three directory authority (<a
href="https://katzenpost.network/docs/specs/pki/">PKI</a>)
nodes</p></li>
<li><p>Six <a
href="https://katzenpost.network/docs/specs/mixnet/">mix</a> nodes,
including one node serving also as both gateway and service
provider</p></li>
<li><p>A ping utility, <code>run-ping</code></p></li>
</ul>
<h2 id="requirements">Requirements</h2>
<p>Before running the Katzenpost docker image, make sure that the
following software is installed.</p>
<ul>
<li><p>A <a href="https://debian.org">Debian GNU Linux</a> or <a
href="https://ubuntu.com">Ubuntu</a> system</p></li>
<li><p><a href="https://git-scm.com/">Git</a></p></li>
<li><p><a href="https://go.dev/">Go</a></p></li>
<li><p><a href="https://www.gnu.org/software/make/">GNU
Make</a></p></li>
<li><p><a
href="https://prometheus.io/docs/introduction/overview/">Prometheus</a></p></li>
<li><p><a href="https://www.docker.com">Docker</a>, <a
href="https://docs.docker.com/compose/">Docker Compose</a>, and
(optionally) <a href="https://podman.io">Podman</a></p>
<div class="note">
<p>If both Docker and Podman are present on your system, Katzenpost uses
Podman. Podman is a drop-in daemonless equivalent to Docker that does
not require superuser privileges to run.</p>
</div></li>
</ul>
<p>On Debian, these software requirements can be installed with the
following commands (running as superuser). <code>Apt</code> will pull in
the needed dependencies.</p>
<pre><code># apt update
# apt install git golang make docker docker-compose podman</code></pre>
<h2 id="install_kp">Preparing to run the container image</h2>
<p>Complete the following procedure to obtain, build, and deploy the
Katzenpost test network.</p>
<ul>
<li><p>Install the Katzenpost code repository, hosted at <a
href="https://github.com/katzenpost"></a>. The main Katzenpost
repository contains code for the server components as well as the docker
image. Clone the repository with the following command (your directory
location may vary):</p>
<pre><code>~$ git clone https://github.com/katzenpost/katzenpost.git</code></pre></li>
<li><p>Navigate to the new <code>katzenpost</code> subdirectory and
ensure that the code is up to date.</p>
<pre><code>~$ cd katzenpost
~/katzenpost$ git checkout main
~/katzenpost$ git pull</code></pre></li>
<li><p>(Optional) Create a development branch and check it out.</p>
<pre><code>~/katzenpost$ git checkout -b devel</code></pre></li>
<li><p>(Optional) If you are using Podman, complete the following
steps:</p>
<ul>
<li><p>Point the DOCKER_HOST environment variable at the Podman
process.</p>
<pre><code>$ export DOCKER_HOST=unix:///var/run/user/$(id -u)/podman/podman.sock</code></pre></li>
<li><p>Set up and start the Podman server (as superuser).</p>
<pre><code>$ podman system service -t 0 $DOCKER_HOST &amp;
$ systemctl --user enable --now podman.socket
                        </code></pre></li>
</ul></li>
</ul>
<h2 id="basic-ops">Operating the test mixnet</h2>
<p>Navigate to <code>katzenpost/docker</code>. The <code>Makefile</code>
contains target operations to create, manage, and test the
self-contained Katzenpost container network. To invoke a target, run a
command with the using the following pattern:</p>
<pre><code> ~/katzenpost/docker$ make target</code></pre>
<p>Running <code>make</code> with no target specified returns a list of
available targets.</p>
<table>
<caption>Table 1: Makefile targets</caption>
<tbody>
<tr class="odd">
<td><p>[none]</p></td>
<td><p>Display this list of targets.</p></td>
</tr>
<tr class="even">
<td><p><strong>start</strong></p></td>
<td><p>Run the test network in the background.</p></td>
</tr>
<tr class="odd">
<td><p><strong>stop</strong></p></td>
<td><p>Stop the test network.</p></td>
</tr>
<tr class="even">
<td><p><strong>wait</strong></p></td>
<td><p>Wait for the test network to have consensus.</p></td>
</tr>
<tr class="odd">
<td><strong>watch</strong></td>
<td><p>Display live log entries until <code>Ctrl-C</code>.</p></td>
</tr>
<tr class="even">
<td><p><strong>status</strong></p></td>
<td><p>Show test network consensus status.</p></td>
</tr>
<tr class="odd">
<td><p><strong>show-latest-vote</strong></p></td>
<td><p>Show latest consensus vote.</p></td>
</tr>
<tr class="even">
<td><p><strong>run-ping</strong></p></td>
<td>Send a ping over the test network.</td>
</tr>
<tr class="odd">
<td><p><strong>clean-bin</strong></p></td>
<td><p>Stop all components and delete binaries.</p></td>
</tr>
<tr class="even">
<td><p><strong>clean-local</strong></p></td>
<td><p>Stop all components, delete binaries, and delete data.</p></td>
</tr>
<tr class="odd">
<td><p><strong>clean-local-dryrun</strong></p></td>
<td><p>Show what clean-local would delete.</p></td>
</tr>
<tr class="even">
<td><p><strong>clean</strong></p></td>
<td><p>Same as <strong>clean-local</strong>, but also deletes
<code>go_deps</code> image.</p></td>
</tr>
</tbody>
</table>
<h3 id="start-mixnet">Starting and monitoring the mixnet</h3>
<p>The first time that you run <code>make start</code>, the Docker image
is downloaded, built, installed, and started. This takes several
minutes. When the build is complete, the command exits while the network
remains running in the background.</p>
<pre><code>~/katzenpost/docker$ make start</code></pre>
<p>Subsequent runs of <code>make start</code> either start or restart
the network without building the components from scratch. The exception
to this is when you delete any of the Katzenpost binaries
(dirauth.alpine, server.alpine, etc.). In that case,
<code>make start</code> rebuilds just the parts of the network dependent
on the deleted binary. For more information about the files created
during the Docker build, see <a href="#topology">Network topology and
components</a>.</p>
<div class="note">
<p>When running <code>make start</code> , be aware of the following
considerations:</p>
<ul>
<li><p>If you intend to use Docker, you need to run <code>make</code> as
superuser. If you are using <code>sudo</code> to elevate your
privileges, you need to edit <code>katzenpost/docker/Makefile</code> to
prepend <code>sudo</code> to each command contained in it.</p></li>
<li><p>If you have Podman installed on your system and you nonetheless
want to run Docker, you can override the default behavior by adding the
argument <code>docker=docker</code> to the command as in the
following:</p>
<pre><code>~/katzenpost/docker$ make run docker=docker </code></pre></li>
</ul>
</div>
<p>After the <code>make start</code> command exits, the mixnet runs in
the background, and you can run <code>make watch</code> to display a
live log of the network activity.</p>
<pre><code>~/katzenpost/docker$ make watch
    ...
    &lt;output&gt;
    ...</code></pre>
<p>When installation is complete, the mix servers vote and reach a
consensus. You can use the <code>wait</code> target to wait for the
mixnet to get consensus and be ready to use. This can also take several
minutes:</p>
<pre><code>~/katzenpost/docker$ make wait
    ...
    &lt;output&gt;
    ...</code></pre>
<p>You can confirm that installation and configuration are complete by
issuing the <code>status</code> command from the same or another
terminal. When the network is ready for use, <code>status</code> begins
returning consensus information similar to the following:</p>
<pre><code>~/katzenpost/docker$ make status
    ...
    00:15:15.003 NOTI state: Consensus made for epoch 1851128 with 3/3 signatures: &amp;{Epoch: 1851128 GenesisEpoch: 1851118
    ...</code></pre>
<h3 id="test-mixnet">Testing the mixnet</h3>
<p>At this point, you should have a locally running mix network. You can
test whether it is working correctly by using <code>run-ping</code>,
which launches a packet into the network and watches for a successful
reply. Run the following command:</p>
<pre><code>~/katzenpost/docker$ make run-ping</code></pre>
<p>If the network is functioning properly, the resulting output contains
lines similar to the following:</p>
<pre><code>19:29:53.541 INFO gateway1_client: sending loop decoy
    !19:29:54.108 INFO gateway1_client: sending loop decoy
    19:29:54.632 INFO gateway1_client: sending loop decoy
    19:29:55.160 INFO gateway1_client: sending loop decoy
    !19:29:56.071 INFO gateway1_client: sending loop decoy
    !19:29:59.173 INFO gateway1_client: sending loop decoy
    !Success rate is 100.000000 percent 10/10)</code></pre>
<p>lf <code>run-ping</code> fails to receive a reply, it eventually
times out with an error message. If this happens, try the command
again.</p>
<div class="note">
<p>If you attempt use <strong>run-ping</strong> too quickly after
starting the mixnet, and consensus has not been reached, the utility may
crash with an error message or hang indefinitely. If this happens, issue
(if necessary) a <code>Ctrl-C</code> key sequence to abort, check the
consensus status with the <code>status</code> command, and then retry
<code>run-ping</code>.</p>
</div>
<h3 id="shutdown-mixnet">Shutting down the mixnet</h3>
<p>The mix network continues to run in the terminal where you started it
until you issue a <code>Ctrl-C</code> key sequence, or until you issue
the following command in another terminal:</p>
<pre><code>~/katzenpost/docker$ make stop</code></pre>
<p>When you stop the network, the binaries and data are left in place.
This allows for a quick restart.</p>
<h3 id="uninstall-mixnet">Uninstalling and cleaning up</h3>
<p>Several command targets can be used to uninstall the Docker image and
restore your system to a clean state. The following examples demonstrate
the commands and their output.</p>
<ul>
<li><p><code>clean-bin</code></p>
<p>To stop the network and delete the compiled binaries, run the
following command:</p>
<pre><code>~/katzenpost/docker$ make clean-bin
    
    [ -e voting_mixnet ] &amp;&amp; cd voting_mixnet &amp;&amp; DOCKER_HOST=unix:///run/user/1000/podman/podman.sock docker-compose down --remove-orphans; rm -fv running.stamp
    Stopping voting_mixnet_auth3_1        ... done
    Stopping voting_mixnet_servicenode1_1 ... done
    Stopping voting_mixnet_metrics_1      ... done
    Stopping voting_mixnet_mix3_1         ... done
    Stopping voting_mixnet_auth2_1        ... done
    Stopping voting_mixnet_mix2_1         ... done
    Stopping voting_mixnet_gateway1_1     ... done
    Stopping voting_mixnet_auth1_1        ... done
    Stopping voting_mixnet_mix1_1         ... done
    Removing voting_mixnet_auth3_1        ... done
    Removing voting_mixnet_servicenode1_1 ... done
    Removing voting_mixnet_metrics_1      ... done
    Removing voting_mixnet_mix3_1         ... done
    Removing voting_mixnet_auth2_1        ... done
    Removing voting_mixnet_mix2_1         ... done
    Removing voting_mixnet_gateway1_1     ... done
    Removing voting_mixnet_auth1_1        ... done
    Removing voting_mixnet_mix1_1         ... done
    removed &#39;running.stamp&#39;
    rm -vf ./voting_mixnet/*.alpine
    removed &#39;./voting_mixnet/echo_server.alpine&#39;
    removed &#39;./voting_mixnet/fetch.alpine&#39;
    removed &#39;./voting_mixnet/memspool.alpine&#39;
    removed &#39;./voting_mixnet/panda_server.alpine&#39;
    removed &#39;./voting_mixnet/pigeonhole.alpine&#39;
    removed &#39;./voting_mixnet/ping.alpine&#39;
    removed &#39;./voting_mixnet/reunion_katzenpost_server.alpine&#39;
    removed &#39;./voting_mixnet/server.alpine&#39;
    removed &#39;./voting_mixnet/voting.alpine&#39;</code></pre>
<p>This command leaves in place the cryptographic keys, the state data,
and the logs.</p></li>
<li><p><code>clean-local-dryrun</code></p>
<p>To diplay a preview of what <code>clean-local</code> would remove,
without actually deleting anything, run the following command:</p>
<pre><code>~/katzenpost/docker$ make clean-local-dryrun</code></pre></li>
<li><p><code>clean-local</code></p>
<p>To delete both compiled binaries and data, run the following
command:</p>
<pre><code>~/katzenpost/docker$ make clean-local
                        
    [ -e voting_mixnet ] &amp;&amp; cd voting_mixnet &amp;&amp; DOCKER_HOST=unix:///run/user/1000/podman/podman.sock docker-compose down --remove-orphans; rm -fv running.stamp
    Removing voting_mixnet_mix2_1         ... done
    Removing voting_mixnet_auth1_1        ... done
    Removing voting_mixnet_auth2_1        ... done
    Removing voting_mixnet_gateway1_1     ... done
    Removing voting_mixnet_mix1_1         ... done
    Removing voting_mixnet_auth3_1        ... done
    Removing voting_mixnet_mix3_1         ... done
    Removing voting_mixnet_servicenode1_1 ... done
    Removing voting_mixnet_metrics_1      ... done
    removed &#39;running.stamp&#39;
    rm -vf ./voting_mixnet/*.alpine
    removed &#39;./voting_mixnet/echo_server.alpine&#39;
    removed &#39;./voting_mixnet/fetch.alpine&#39;
    removed &#39;./voting_mixnet/memspool.alpine&#39;
    removed &#39;./voting_mixnet/panda_server.alpine&#39;
    removed &#39;./voting_mixnet/pigeonhole.alpine&#39;
    removed &#39;./voting_mixnet/reunion_katzenpost_server.alpine&#39;
    removed &#39;./voting_mixnet/server.alpine&#39;
    removed &#39;./voting_mixnet/voting.alpine&#39;
    git clean -f -x voting_mixnet
    Removing voting_mixnet/
    git status .
    On branch main
    Your branch is up to date with &#39;origin/main&#39;.</code></pre></li>
<li><p><code>clean</code></p>
<p>To stop the the network and delete the binaries, the data, and the
go_deps image, run the following command as superuser:</p>
<pre><code>~/katzenpost/docker$ sudo make clean</code></pre></li>
</ul>
<h2 id="topology">Network topology and components</h2>
<p>The Docker image deploys a working mixnet with all components and
component groups needed to perform essential mixnet functions:</p>
<ul>
<li><p>message mixing (including packet reordering, timing
randomization, injection of decoy traffic, obfuscation of senders and
receivers, and so on)</p></li>
<li><p>service provisioning</p></li>
<li><p>internal authentication and integrity monitoring</p></li>
<li><p>interfacing with external clients</p></li>
</ul>
<div class="warning">
<p>While suited for client development and testing, the test mixnet
omits performance and security redundancies. <em>Do not use it in
production.</em></p>
</div>
<p>The following diagram illustrates the components and their network
interactions. The gray blocks represent nodes, and the arrows represent
information transfer.</p>
<figure>
<img src="/static/admin_guide/pix/katzenpost-docker.png" alt="Test network topology" />
<figcaption aria-hidden="true">Test network topology</figcaption>
</figure>
<p>On the left, the <strong>Client</strong> transmits a message (shown
by purple arrows) through the <strong>Gateway node</strong>, across
three <strong>mix node</strong> layers, to the <strong>Service
node</strong>. The <strong>Service node</strong> processes the request
and responds with a reply (shown by the green arrows) that traverses the
<strong>mix node</strong> layers before exiting the mixnet via the
<strong>Gateway node</strong> and arriving at the
<strong>Client</strong>.</p>
<p>On the right, directory authorities <strong>Dirauth 1</strong>,
<strong>Dirauth 2</strong>, and <strong>Dirauth 3</strong> provide PKI
services. The directory authorities receive <strong>mix
descriptors</strong> from the other nodes, collate these into a
<strong>consensus document</strong> containing validated network status
and authentication materials , and make that available to the other
nodes.</p>
<p>The elements in the topology diagram map to the mixnet's component
nodes as shown in the following table. Note that all nodes share the
same IP address (127.0.0.1, i.e., localhost), but are accessed through
different ports. Each node type links to additional information in <a
href="#components">Components and configuration of the Katzenpost
mixnet</a>.</p>
<table>
<caption>Table 2: Test mixnet hosts</caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr class="header">
<th>Node type</th>
<th>Docker ID</th>
<th>Diagram label</th>
<th>IP address</th>
<th>TCP port</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p><a href="#intro-dirauth">Directory authority</a></p></td>
<td>auth1</td>
<td>Dirauth1</td>
<td><p>127.0.0.1 (localhost)</p></td>
<td><p>30001</p></td>
</tr>
<tr class="even">
<td><p>auth2</p></td>
<td>Dirauth 2</td>
<td><p>30002</p></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><p>auth3</p></td>
<td>Dirauth 3</td>
<td><p>30003</p></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><a href="#intro-gateway">Gateway node</a></td>
<td>gateway1</td>
<td>Gateway node</td>
<td>30004</td>
<td></td>
</tr>
<tr class="odd">
<td><p><a href="#intro-service">Service node</a></p></td>
<td><p>servicenode1</p></td>
<td>Service node</td>
<td><p>30006</p></td>
<td></td>
</tr>
<tr class="even">
<td><p><a href="#intro-mix">Mix node</a></p></td>
<td><p>mix1</p></td>
<td>Layer 1 mix node</td>
<td><p>30008</p></td>
<td></td>
</tr>
<tr class="odd">
<td><p>mix2</p></td>
<td>Layer 2 mix node</td>
<td><p>30010</p></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><p>mix3</p></td>
<td>Layer 3 mix node</td>
<td><p>30012</p></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3>The Docker file tree</h3>
<p>The following <a
href="https://manpages.debian.org/bookworm/tree/tree.1.en.html">tree</a>
output shows the location, relative to the <code>katzenpost</code>
repository root, of the files created by the Docker build. During
testing and use, you would normally touch only the TOML configuration
file associated with each node, as highlighted in the listing. For help
in understanding these files and a complete list of configuration
options, follow the links in Table 2: Test mixnet hosts.</p>
<h2></h2>
<pre><code>katzenpost/docker/voting_mixnet/
|---auth1
|   |---authority.toml
|   |---identity.private.pem
|   |---identity.public.pem
|   |---katzenpost.log
|   |---link.private.pem
|   |---link.public.pem
|   |---persistence.db
|---auth2
|   |---authority.toml
|   |---identity.private.pem
|   |---identity.public.pem
|   |---katzenpost.log
|   |---link.private.pem
|   |---link.public.pem
|   |---persistence.db
|---auth3
|   |---authority.toml
|   |---identity.private.pem
|   |---identity.public.pem
|   |---katzenpost.log
|   |---link.private.pem
|   |---link.public.pem
|   |---persistence.db
|---client
|   |---client.toml
|---client2
|   |---client.toml
|---dirauth.alpine
|---docker-compose.yml
|---echo_server.alpine
|---fetch.alpine
|---gateway1
|   |---identity.private.pem
|   |---identity.public.pem
|   |---katzenpost.log
|   |---katzenpost.toml
|   |---link.private.pem
|   |---link.public.pem
|   |---management_sock
|   |---spool.db
|   |---users.db
|---memspool.alpine
|---mix1
|   |---identity.private.pem
|   |---identity.public.pem
|   |---katzenpost.log
|   |---katzenpost.toml
|   |---link.private.pem
|   |---link.public.pem
|---mix2
|   |---identity.private.pem
|   |---identity.public.pem
|   |---katzenpost.log
|   |---katzenpost.toml
|   |---link.private.pem
|   |---link.public.pem
|---mix3
|   |---identity.private.pem
|   |---identity.public.pem
|   |---katzenpost.log
|   |---katzenpost.toml
|   |---link.private.pem
|   |---link.public.pem
|---panda_server.alpine
|---pigeonhole.alpine
|---ping.alpine
|---prometheus.yml
|---proxy_client.alpine
|---proxy_server.alpine
|---running.stamp
|---server.alpine
|---servicenode1
|   |---identity.private.pem
|   |---identity.public.pem
|   |---katzenpost.log
|   |---katzenpost.toml
|   |---link.private.pem
|   |---link.public.pem
|   |---management_sock
|   |---map.storage
|   |---memspool.13.log
|   |---memspool.storage
|   |---panda.25.log
|   |---panda.storage
|   |---pigeonHole.19.log
|   |---proxy.31.log
|---voting_mixnet</code></pre>
<p>Examples of complete TOML configuration files are provided in <a
href="#docker-config">Appendix: Configuration files from the Docker test
mixnet </a>.</p>
<h1 id="docker-config">Appendix: Configuration files from the Docker
test mixnet</h1>
<p>As an aid to adminstrators implementing a Katzenpost mixnet, this
appendix provides lightly edited examples of configuration files for
each Katzenpost node type. These files are drawn from a built instance
of the <a href="#container">Docker test mixnet</a>. These code listings
are meant to be used as a reference alongside the detailed configuration
documentation in <a href="#components">Components and configuration of
the Katzenpost mixnet</a>. You cannot use these listings as a drop-in
solution in your own mixnets for reasons explained in the <a
href="#topology">Network topology and components</a> section of the
Docker test mixnet documentation.</p>
<h2 id="dirauth-config">Directory authority</h2>
<p>Source:
<code>../katzenpost/docker/voting_mixnet/auth1/authority.toml</code></p>
<pre><code>[Server]
  Identifier = &quot;auth1&quot;
  WireKEMScheme = &quot;xwing&quot;
  PKISignatureScheme = &quot;Ed448-Dilithium3&quot;
  Addresses = [&quot;tcp://127.0.0.1:30001&quot;]
  DataDir = &quot;/voting_mixnet/auth1&quot;

[[Authorities]]
  Identifier = &quot;auth1&quot;
  IdentityPublicKey = &quot;-----BEGIN ED448-DILITHIUM3 PUBLIC KEY-----\nfvcvAfUpeu7lMHjQBw [...] Gpi8ovBXl9ENIHLwA=\n-----END ED448-DILITHIUM3 PUBLIC KEY-----\n&quot;
  PKISignatureScheme = &quot;Ed448-Dilithium3&quot;
  LinkPublicKey = &quot;-----BEGIN XWING PUBLIC KEY-----\nsxxS04mftoEmwjxE/w [...] expP2fbERpGQwVNg==\n-----END XWING PUBLIC KEY-----\n&quot;
  WireKEMScheme = &quot;xwing&quot;
  Addresses = [&quot;tcp://127.0.0.1:30001&quot;]

[[Authorities]]
  Identifier = &quot;auth2&quot;
  IdentityPublicKey = &quot;-----BEGIN ED448-DILITHIUM3 PUBLIC KEY-----\n5nsy6uFQ1782fZ+iYn [...] Sdr2xoinylYJr/3AA=\n-----END ED448-DILITHIUM3 PUBLIC KEY-----\n&quot;
  PKISignatureScheme = &quot;Ed448-Dilithium3&quot;
  LinkPublicKey = &quot;-----BEGIN XWING PUBLIC KEY-----\nkQzCJvaS6jg06szLea [...] PG1Bzx1JwHGFxRBQ==\n-----END XWING PUBLIC KEY-----\n&quot;
  WireKEMScheme = &quot;xwing&quot;
  Addresses = [&quot;tcp://127.0.0.1:30002&quot;]

[[Authorities]]
  Identifier = &quot;auth3&quot;
  IdentityPublicKey = &quot;-----BEGIN ED448-DILITHIUM3 PUBLIC KEY-----\nJzkFpS035de1PmA2MM [...] jo6Z7is9GLs0YxVQA=\n-----END ED448-DILITHIUM3 PUBLIC KEY-----\n&quot;
  PKISignatureScheme = &quot;Ed448-Dilithium3&quot;
  LinkPublicKey = &quot;-----BEGIN XWING PUBLIC KEY-----\n+pIUsgEGwHa8k4GZcb [...] 1mxoc+4kcgZWuOAg==\n-----END XWING PUBLIC KEY-----\n&quot;
  WireKEMScheme = &quot;xwing&quot;
  Addresses = [&quot;tcp://127.0.0.1:30003&quot;]

[Logging]
  Disable = false
  File = &quot;katzenpost.log&quot;
  Level = &quot;INFO&quot;

[Parameters]
  SendRatePerMinute = 0
  Mu = 0.005
  MuMaxDelay = 1000
  LambdaP = 0.001
  LambdaPMaxDelay = 1000
  LambdaL = 0.0005
  LambdaLMaxDelay = 1000
  LambdaD = 0.0005
  LambdaDMaxDelay = 3000
  LambdaM = 0.0005
  LambdaG = 0.0
  LambdaMMaxDelay = 100
  LambdaGMaxDelay = 100

[Debug]
  Layers = 3
  MinNodesPerLayer = 1
  GenerateOnly = false

[[Mixes]]
  Identifier = &quot;mix1&quot;
  IdentityPublicKeyPem = &quot;../mix1/identity.public.pem&quot;

[[Mixes]]
  Identifier = &quot;mix2&quot;
  IdentityPublicKeyPem = &quot;../mix2/identity.public.pem&quot;

[[Mixes]]
  Identifier = &quot;mix3&quot;
  IdentityPublicKeyPem = &quot;../mix3/identity.public.pem&quot;

[[GatewayNodes]]
  Identifier = &quot;gateway1&quot;
  IdentityPublicKeyPem = &quot;../gateway1/identity.public.pem&quot;

[[ServiceNodes]]
  Identifier = &quot;servicenode1&quot;
  IdentityPublicKeyPem = &quot;../servicenode1/identity.public.pem&quot;

[Topology]

  [[Topology.Layers]]

    [[Topology.Layers.Nodes]]
      Identifier = &quot;mix1&quot;
      IdentityPublicKeyPem = &quot;../mix1/identity.public.pem&quot;

  [[Topology.Layers]]

    [[Topology.Layers.Nodes]]
      Identifier = &quot;mix2&quot;
      IdentityPublicKeyPem = &quot;../mix2/identity.public.pem&quot;

  [[Topology.Layers]]

    [[Topology.Layers.Nodes]]
      Identifier = &quot;mix3&quot;
      IdentityPublicKeyPem = &quot;../mix3/identity.public.pem&quot;

[SphinxGeometry]
  PacketLength = 3082
  NrHops = 5
  HeaderLength = 476
  RoutingInfoLength = 410
  PerHopRoutingInfoLength = 82
  SURBLength = 572
  SphinxPlaintextHeaderLength = 2
  PayloadTagLength = 32
  ForwardPayloadLength = 2574
  UserForwardPayloadLength = 2000
  NextNodeHopLength = 65
  SPRPKeyMaterialLength = 64
  NIKEName = &quot;x25519&quot;
  KEMName = &quot;&quot;</code></pre>
<h2 id="mix-node-config">Mix node</h2>
<p>Source:<code>../katzenpost/docker/voting_mixnet/mix1/katzenpost.toml</code></p>
<pre><code>[Server]
  Identifier = &quot;mix1&quot;
  WireKEM = &quot;xwing&quot;
  PKISignatureScheme = &quot;Ed448-Dilithium3&quot;
  Addresses = [&quot;tcp://127.0.0.1:30010&quot;, &quot;quic://[::1]:30011&quot;]
  MetricsAddress = &quot;127.0.0.1:30012&quot;
  DataDir = &quot;/voting_mixnet/mix1&quot;
  IsGatewayNode = false
  IsServiceNode = false

[Logging]
  Disable = false
  File = &quot;katzenpost.log&quot;
  Level = &quot;INFO&quot;

[PKI]
  [PKI.Voting]

    [[PKI.Voting.Authorities]]
      Identifier = &quot;auth1&quot;
      IdentityPublicKey = &quot;-----BEGIN ED448-DILITHIUM3 PUBLIC KEY-----\nfvcvAfUpeu7lMHjQBw [...] Gpi8ovBXl9ENIHLwA=\n-----END ED448-DILITHIUM3 PUBLIC KEY-----\n&quot;
      PKISignatureScheme = &quot;Ed448-Dilithium3&quot;
      LinkPublicKey = &quot;-----BEGIN XWING PUBLIC KEY-----\nsxxS04mftoEmwjxE/w [...] expP2fbERpGQwVNg==\n-----END XWING PUBLIC KEY-----\n&quot;
      WireKEMScheme = &quot;xwing&quot;
      Addresses = [&quot;tcp://127.0.0.1:30001&quot;]

    [[PKI.Voting.Authorities]]
      Identifier = &quot;auth2&quot;
      IdentityPublicKey = &quot;-----BEGIN ED448-DILITHIUM3 PUBLIC KEY-----\n5nsy6uFQ1782fZ+iYn [...] Sdr2xoinylYJr/3AA=\n-----END ED448-DILITHIUM3 PUBLIC KEY-----\n&quot;
      PKISignatureScheme = &quot;Ed448-Dilithium3&quot;
      LinkPublicKey = &quot;-----BEGIN XWING PUBLIC KEY-----\nkQzCJvaS6jg06szLea [...] PG1Bzx1JwHGFxRBQ==\n-----END XWING PUBLIC KEY-----\n&quot;
      WireKEMScheme = &quot;xwing&quot;
      Addresses = [&quot;tcp://127.0.0.1:30002&quot;]

    [[PKI.Voting.Authorities]]
      Identifier = &quot;auth3&quot;
      IdentityPublicKey = &quot;-----BEGIN ED448-DILITHIUM3 PUBLIC KEY-----\nJzkFpS035de1PmA2M [...] jo6Z7is9GLs0YxVQA=\n-----END ED448-DILITHIUM3 PUBLIC KEY-----\n&quot;
      PKISignatureScheme = &quot;Ed448-Dilithium3&quot;
      LinkPublicKey = &quot;-----BEGIN XWING PUBLIC KEY-----\n+pIUsgEGwHa8k4GZcb [...] 1mxoc+4kcgZWuOAg==\n-----END XWING PUBLIC KEY-----\n&quot;
      WireKEMScheme = &quot;xwing&quot;
      Addresses = [&quot;tcp://127.0.0.1:30003&quot;]

[Management]
  Enable = false
  Path = &quot;/voting_mixnet/mix1/management_sock&quot;

[SphinxGeometry]
  PacketLength = 3082
  NrHops = 5
  HeaderLength = 476
  RoutingInfoLength = 410
  PerHopRoutingInfoLength = 82
  SURBLength = 572
  SphinxPlaintextHeaderLength = 2
  PayloadTagLength = 32
  ForwardPayloadLength = 2574
  UserForwardPayloadLength = 2000
  NextNodeHopLength = 65
  SPRPKeyMaterialLength = 64
  NIKEName = &quot;x25519&quot;
  KEMName = &quot;&quot;

[Debug]
  NumSphinxWorkers = 16
  NumServiceWorkers = 3
  NumGatewayWorkers = 3
  NumKaetzchenWorkers = 3
  SchedulerExternalMemoryQueue = false
  SchedulerQueueSize = 0
  SchedulerMaxBurst = 16
  UnwrapDelay = 250
  GatewayDelay = 500
  ServiceDelay = 500
  KaetzchenDelay = 750
  SchedulerSlack = 150
  SendSlack = 50
  DecoySlack = 15000
  ConnectTimeout = 60000
  HandshakeTimeout = 30000
  ReauthInterval = 30000
  SendDecoyTraffic = false
  DisableRateLimit = false
  GenerateOnly = false</code></pre>
<h2 id="gateway-node-config">Gateway node</h2>
<p>Source:
<code>../katzenpost/docker/voting_mixnet/gateway1/katzenpost.toml</code></p>
<pre><code>[Server]
  Identifier = &quot;gateway1&quot;
  WireKEM = &quot;xwing&quot;
  PKISignatureScheme = &quot;Ed448-Dilithium3&quot;
  Addresses = [&quot;tcp://127.0.0.1:30004&quot;, &quot;quic://[::1]:30005&quot;, &quot;onion://thisisjustatestoniontoverifythatconfigandpkiworkproperly.onion:4242&quot;]
  BindAddresses = [&quot;tcp://127.0.0.1:30004&quot;, &quot;quic://[::1]:30005&quot;]
  MetricsAddress = &quot;127.0.0.1:30006&quot;
  DataDir = &quot;/voting_mixnet/gateway1&quot;
  IsGatewayNode = true
  IsServiceNode = false

[Logging]
  Disable = false
  File = &quot;katzenpost.log&quot;
  Level = &quot;INFO&quot;

[Gateway]
  [Gateway.UserDB]
    Backend = &quot;bolt&quot;
    [Gateway.UserDB.Bolt]
      UserDB = &quot;/voting_mixnet/gateway1/users.db&quot;
  [Gateway.SpoolDB]
    Backend = &quot;bolt&quot;
    [Gateway.SpoolDB.Bolt]
      SpoolDB = &quot;/voting_mixnet/gateway1/spool.db&quot;

[PKI]
  [PKI.Voting]

    [[PKI.Voting.Authorities]]
      Identifier = &quot;auth1&quot;
      IdentityPublicKey = &quot;-----BEGIN ED448-DILITHIUM3 PUBLIC KEY-----\nfvcvAfUpeu7lMHjQBw [...] Gpi8ovBXl9ENIHLwA=\n-----END ED448-DILITHIUM3 PUBLIC KEY-----\n&quot;
      PKISignatureScheme = &quot;Ed448-Dilithium3&quot;
      LinkPublicKey = &quot;-----BEGIN XWING PUBLIC KEY-----\nsxxS04mftoEmwjxE/w [...] expP2fbERpGQwVNg==\n-----END XWING PUBLIC KEY-----\n&quot;
      WireKEMScheme = &quot;xwing&quot;
      Addresses = [&quot;tcp://127.0.0.1:30001&quot;]

    [[PKI.Voting.Authorities]]
      Identifier = &quot;auth2&quot;
      IdentityPublicKey = &quot;-----BEGIN ED448-DILITHIUM3 PUBLIC KEY-----\n5nsy6uFQ1782fZ+iYn [...] Sdr2xoinylYJr/3AA=\n-----END ED448-DILITHIUM3 PUBLIC KEY-----\n&quot;
      PKISignatureScheme = &quot;Ed448-Dilithium3&quot;
      LinkPublicKey = &quot;-----BEGIN XWING PUBLIC KEY-----\nkQzCJvaS6jg06szLea [...] PG1Bzx1JwHGFxRBQ==\n-----END XWING PUBLIC KEY-----\n&quot;
      WireKEMScheme = &quot;xwing&quot;
      Addresses = [&quot;tcp://127.0.0.1:30002&quot;]

    [[PKI.Voting.Authorities]]
      Identifier = &quot;auth3&quot;
      IdentityPublicKey = &quot;-----BEGIN ED448-DILITHIUM3 PUBLIC KEY-----\nJzkFpS035de1PmA2MM [...] jo6Z7is9GLs0YxVQA=\n-----END ED448-DILITHIUM3 PUBLIC KEY-----\n&quot;
      PKISignatureScheme = &quot;Ed448-Dilithium3&quot;
      LinkPublicKey = &quot;-----BEGIN XWING PUBLIC KEY-----\n+pIUsgEGwHa8k4GZcb [...] 1mxoc+4kcgZWuOAg==\n-----END XWING PUBLIC KEY-----\n&quot;
      WireKEMScheme = &quot;xwing&quot;
      Addresses = [&quot;tcp://127.0.0.1:30003&quot;]

[Management]
  Enable = true
  Path = &quot;/voting_mixnet/gateway1/management_sock&quot;

[SphinxGeometry]
  PacketLength = 3082
  NrHops = 5
  HeaderLength = 476
  RoutingInfoLength = 410
  PerHopRoutingInfoLength = 82
  SURBLength = 572
  SphinxPlaintextHeaderLength = 2
  PayloadTagLength = 32
  ForwardPayloadLength = 2574
  UserForwardPayloadLength = 2000
  NextNodeHopLength = 65
  SPRPKeyMaterialLength = 64
  NIKEName = &quot;x25519&quot;
  KEMName = &quot;&quot;

[Debug]
  NumSphinxWorkers = 16
  NumServiceWorkers = 3
  NumGatewayWorkers = 3
  NumKaetzchenWorkers = 3
  SchedulerExternalMemoryQueue = false
  SchedulerQueueSize = 0
  SchedulerMaxBurst = 16
  UnwrapDelay = 250
  GatewayDelay = 500
  ServiceDelay = 500
  KaetzchenDelay = 750
  SchedulerSlack = 150
  SendSlack = 50
  DecoySlack = 15000
  ConnectTimeout = 60000
  HandshakeTimeout = 30000
  ReauthInterval = 30000
  SendDecoyTraffic = false
  DisableRateLimit = false
  GenerateOnly = false</code></pre>
<h2 id="service-node-config">Service node</h2>
<p>Source:
<code>../katzenpost/docker/voting_mixnet/servicenode1/katzenpost.toml</code></p>
<pre><code>[Server]
  Identifier = &quot;servicenode1&quot;
  WireKEM = &quot;xwing&quot;
  PKISignatureScheme = &quot;Ed448-Dilithium3&quot;
  Addresses = [&quot;tcp://127.0.0.1:30007&quot;, &quot;quic://[::1]:30008&quot;]
  MetricsAddress = &quot;127.0.0.1:30009&quot;
  DataDir = &quot;/voting_mixnet/servicenode1&quot;
  IsGatewayNode = false
  IsServiceNode = true

[Logging]
  Disable = false
  File = &quot;katzenpost.log&quot;
  Level = &quot;INFO&quot;

[ServiceNode]

  [[ServiceNode.Kaetzchen]]
    Capability = &quot;echo&quot;
    Endpoint = &quot;+echo&quot;
    Disable = false

  [[ServiceNode.Kaetzchen]]
    Capability = &quot;testdest&quot;
    Endpoint = &quot;+testdest&quot;
    Disable = false

  [[ServiceNode.CBORPluginKaetzchen]]
    Capability = &quot;spool&quot;
    Endpoint = &quot;+spool&quot;
    Command = &quot;/voting_mixnet/memspool.alpine&quot;
    MaxConcurrency = 1
    Disable = false
    [ServiceNode.CBORPluginKaetzchen.Config]
      data_store = &quot;/voting_mixnet/servicenode1/memspool.storage&quot;
      log_dir = &quot;/voting_mixnet/servicenode1&quot;

  [[ServiceNode.CBORPluginKaetzchen]]
    Capability = &quot;pigeonhole&quot;
    Endpoint = &quot;+pigeonhole&quot;
    Command = &quot;/voting_mixnet/pigeonhole.alpine&quot;
    MaxConcurrency = 1
    Disable = false
    [ServiceNode.CBORPluginKaetzchen.Config]
      db = &quot;/voting_mixnet/servicenode1/map.storage&quot;
      log_dir = &quot;/voting_mixnet/servicenode1&quot;

  [[ServiceNode.CBORPluginKaetzchen]]
    Capability = &quot;panda&quot;
    Endpoint = &quot;+panda&quot;
    Command = &quot;/voting_mixnet/panda_server.alpine&quot;
    MaxConcurrency = 1
    Disable = false
    [ServiceNode.CBORPluginKaetzchen.Config]
      fileStore = &quot;/voting_mixnet/servicenode1/panda.storage&quot;
      log_dir = &quot;/voting_mixnet/servicenode1&quot;
      log_level = &quot;INFO&quot;

  [[ServiceNode.CBORPluginKaetzchen]]
    Capability = &quot;http&quot;
    Endpoint = &quot;+http&quot;
    Command = &quot;/voting_mixnet/proxy_server.alpine&quot;
    MaxConcurrency = 1
    Disable = false
    [ServiceNode.CBORPluginKaetzchen.Config]
      host = &quot;localhost:4242&quot;
      log_dir = &quot;/voting_mixnet/servicenode1&quot;
      log_level = &quot;DEBUG&quot;

[PKI]
  [PKI.Voting]

    [[PKI.Voting.Authorities]]
      Identifier = &quot;auth1&quot;
      IdentityPublicKey = &quot;-----BEGIN ED448-DILITHIUM3 PUBLIC KEY-----\nfvcvAfUpeu7lMHjQBw [...] Gpi8ovBXl9ENIHLwA=\n-----END ED448-DILITHIUM3 PUBLIC KEY-----\n&quot;
      PKISignatureScheme = &quot;Ed448-Dilithium3&quot;
      LinkPublicKey = &quot;-----BEGIN XWING PUBLIC KEY-----\nsxxS04mftoEmwjxE/w [...] expP2fbERpGQwVNg==\n-----END XWING PUBLIC KEY-----\n&quot;
      WireKEMScheme = &quot;xwing&quot;
      Addresses = [&quot;tcp://127.0.0.1:30001&quot;]

    [[PKI.Voting.Authorities]]
      Identifier = &quot;auth2&quot;
      IdentityPublicKey = &quot;-----BEGIN ED448-DILITHIUM3 PUBLIC KEY-----\n5nsy6uFQ1782fZ+iYn [...] Sdr2xoinylYJr/3AA=\n-----END ED448-DILITHIUM3 PUBLIC KEY-----\n&quot;
      PKISignatureScheme = &quot;Ed448-Dilithium3&quot;
      LinkPublicKey = &quot;-----BEGIN XWING PUBLIC KEY-----\nkQzCJvaS6jg06szLea [...] PG1Bzx1JwHGFxRBQ==\n-----END XWING PUBLIC KEY-----\n&quot;
      WireKEMScheme = &quot;xwing&quot;
      Addresses = [&quot;tcp://127.0.0.1:30002&quot;]

    [[PKI.Voting.Authorities]]
      Identifier = &quot;auth3&quot;
      IdentityPublicKey = &quot;-----BEGIN ED448-DILITHIUM3 PUBLIC KEY-----\nJzkFpS035de1PmA2MM [...] jo6Z7is9GLs0YxVQA=\n-----END ED448-DILITHIUM3 PUBLIC KEY-----\n&quot;
      PKISignatureScheme = &quot;Ed448-Dilithium3&quot;
      LinkPublicKey = &quot;-----BEGIN XWING PUBLIC KEY-----\n+pIUsgEGwHa8k4GZcb [...] 1mxoc+4kcgZWuOAg==\n-----END XWING PUBLIC KEY-----\n&quot;
      WireKEMScheme = &quot;xwing&quot;
      Addresses = [&quot;tcp://127.0.0.1:30003&quot;]

[Management]
  Enable = true
  Path = &quot;/voting_mixnet/servicenode1/management_sock&quot;

[SphinxGeometry]
  PacketLength = 3082
  NrHops = 5
  HeaderLength = 476
  RoutingInfoLength = 410
  PerHopRoutingInfoLength = 82
  SURBLength = 572
  SphinxPlaintextHeaderLength = 2
  PayloadTagLength = 32
  ForwardPayloadLength = 2574
  UserForwardPayloadLength = 2000
  NextNodeHopLength = 65
  SPRPKeyMaterialLength = 64
  NIKEName = &quot;x25519&quot;
  KEMName = &quot;&quot;

[Debug]
  NumSphinxWorkers = 16
  NumServiceWorkers = 3
  NumGatewayWorkers = 3
  NumKaetzchenWorkers = 4
  SchedulerExternalMemoryQueue = false
  SchedulerQueueSize = 0
  SchedulerMaxBurst = 16
  UnwrapDelay = 250
  GatewayDelay = 500
  ServiceDelay = 500
  KaetzchenDelay = 750
  SchedulerSlack = 150
  SendSlack = 50
  DecoySlack = 15000
  ConnectTimeout = 60000
  HandshakeTimeout = 30000
  ReauthInterval = 30000
  SendDecoyTraffic = false
  DisableRateLimit = false
  GenerateOnly = false</code></pre>
<h1 id="gensphinx">Appendix: Using <em>gensphinx</em></h1>
<p>To Do</p>
</body>
</html>
